<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="运气也是成功的一部分">
<meta property="og:type" content="website">
<meta property="og:title" content="河马窝苑">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="河马窝苑">
<meta property="og:description" content="运气也是成功的一部分">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="河马">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>河马窝苑</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">河马窝苑</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="download fa-fw"></i>资源</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/15/CAP定理&&BASE理论/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="河马">
      <meta itemprop="description" content="运气也是成功的一部分">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="河马窝苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/15/fastJson/" class="post-title-link" itemprop="url">fastJson</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-15 19:21:38 / 修改时间：19:31:55" itemprop="dateCreated datePublished" datetime="2023-08-15T19:21:38+08:00">2023-08-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">优点：</span><br><span class="line">    速度快</span><br><span class="line">    使用广泛</span><br><span class="line">    测试完备</span><br><span class="line">    使用简单</span><br><span class="line">    功能完备</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">对象转字符串（序列化）</span><br><span class="line">	JSON.toJSONString(对象)</span><br><span class="line"></span><br><span class="line">集合转字符串（序列化）</span><br><span class="line">	JSON.toJSONString(集合)</span><br><span class="line"></span><br><span class="line">Json字符串转List集合（反序列化）</span><br><span class="line">	JSON.parseArray(字符串,集合泛型的class对象)</span><br><span class="line"></span><br><span class="line">Json字符串转Map集合（反序列化）</span><br><span class="line">	<span class="comment">//直接进行反序列化，Map集合没有泛型的，泛型没有是不安全的集合</span></span><br><span class="line">	JSON.parseObject(字符串)</span><br><span class="line">    <span class="comment">//加泛型</span></span><br><span class="line">    JSON.parseObject(字符串,<span class="keyword">new</span> <span class="title class_">TypeReference</span>&lt;Map&lt;String,Student&gt;&gt;()&#123;&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SerializerFeature枚举</span><br><span class="line">	进行序列化时，可以自定义特殊需求</span><br><span class="line">    JSON.toJSONString（）</span><br><span class="line">        参数一：序列化对象</span><br><span class="line">        参数二：SerializerFeature枚举类型的可变参数</span><br><span class="line">            WriteMapNullValue:序列化<span class="literal">null</span>值的字段</span><br><span class="line">            WriteNullStringAsEmpty:序列化<span class="literal">null</span>值的字段，值为<span class="string">&quot;&quot;</span></span><br><span class="line">            WriteNullNumberAsZero:序列化<span class="literal">null</span>值的字段,值为<span class="number">0</span></span><br><span class="line">        	WriteNullBooleanAsFalse:序列化<span class="literal">null</span>值的字段，值为<span class="literal">false</span></span><br><span class="line">            WriteDateUseDateForm:序列化日期格式化</span><br><span class="line">            PrettyFormat：格式化，纵向输出</span><br><span class="line"></span><br><span class="line"><span class="meta">@JSonField</span></span><br><span class="line">    作用再方法，字段，参数上，可在序列化和反序列化时进行特性功能定制</span><br><span class="line">	注解属性</span><br><span class="line">        name 指定序列化后的名字</span><br><span class="line">        ordinal 指定序列化后的字段顺序  属性值越小越靠前</span><br><span class="line">        format 指定序列化后的格式</span><br><span class="line">        serialize 指定是否序列化该字段 默认<span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@JSonType</span></span><br><span class="line">    作用在类上</span><br><span class="line">    注解属性</span><br><span class="line">        includes 要被序列化的字段</span><br><span class="line">    	orders  序列化后的顺序</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="代码测试"><a href="#代码测试" class="headerlink" title="代码测试"></a>代码测试</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.sky.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONArray;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JSONObjectTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    JSONObject可理解为JSON格式的数据结构（key-value 结构）</span></span><br><span class="line"><span class="comment">    使用put方法给json对象添加元素,</span></span><br><span class="line"><span class="comment">    JSON值可以是另一个JSON 对象，数组，数字，String，bool或null</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    依赖</span></span><br><span class="line"><span class="comment">    &lt;dependency&gt;</span></span><br><span class="line"><span class="comment">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span></span><br><span class="line"><span class="comment">        &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span></span><br><span class="line"><span class="comment">        &lt;version&gt;1.2.46&lt;/version&gt;</span></span><br><span class="line"><span class="comment">    &lt;/dependency&gt;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    toJSONString(Object)【将指定的对象序列化成Json表示形式】</span></span><br><span class="line"><span class="comment">    parseObject(String, Class)【将json反序列化为指定的Class模式】</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">JSONObjectTest</span><span class="params">()</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * JSONObject——put 方法</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>();</span><br><span class="line">        <span class="comment">//数字</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;1&quot;</span>,<span class="number">123</span>);    <span class="comment">//int</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;7&quot;</span>,<span class="number">123f</span>);   <span class="comment">//float</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;8&quot;</span>,<span class="number">123d</span>);   <span class="comment">//double</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;9&quot;</span>,<span class="number">123L</span>);   <span class="comment">//Long</span></span><br><span class="line">        <span class="comment">//数组</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;2&quot;</span>, <span class="keyword">new</span> <span class="title class_">String</span>[] &#123;<span class="string">&quot;nihao&quot;</span>, <span class="string">&quot;beannew&quot;</span>&#125;);</span><br><span class="line">        <span class="comment">// 字符串</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;nihao&quot;</span>);</span><br><span class="line">        <span class="comment">// 布尔</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;4&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// 空</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;5&quot;</span>, <span class="literal">null</span>);</span><br><span class="line">        <span class="comment">// 实体</span></span><br><span class="line">        jsonObject.put(<span class="string">&quot;6&quot;</span>, <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;nihao&quot;</span>, <span class="string">&quot;beannew&quot;</span>, <span class="number">18</span>));</span><br><span class="line">        System.out.println(jsonObject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//可根据源码和结果看出JSONObject是Map结构</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * JSONObject——GET方法</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        System.out.println(jsonObject.get(<span class="string">&quot;1&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.get(<span class="string">&quot;7&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.get(<span class="string">&quot;8&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.get(<span class="string">&quot;9&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.get(<span class="string">&quot;2&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.get(<span class="string">&quot;3&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.get(<span class="string">&quot;4&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.get(<span class="string">&quot;5&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.get(<span class="string">&quot;6&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.getInteger(<span class="string">&quot;1&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.getString(<span class="string">&quot;3&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.getFloat(<span class="string">&quot;7&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.getDouble(<span class="string">&quot;8&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.getLong(<span class="string">&quot;9&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.getBoolean(<span class="string">&quot;4&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.getString(<span class="string">&quot;5&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.getString(<span class="string">&quot;6&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.getJSONArray(<span class="string">&quot;2&quot;</span>));</span><br><span class="line">        System.out.println(jsonObject.getJSONObject(<span class="string">&quot;6&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        putAll</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Map&lt;String,String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">        map.put(<span class="string">&quot;1&quot;</span>,<span class="string">&quot;101&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;2&quot;</span>, <span class="string">&quot;102&quot;</span>);</span><br><span class="line">        map.put(<span class="string">&quot;3&quot;</span>, <span class="string">&quot;103&quot;</span>);</span><br><span class="line">        <span class="comment">//putAll 将map中的数据全部添加到JSONObject中</span></span><br><span class="line">        jsonObject.putAll(map);</span><br><span class="line">        System.out.println(jsonObject);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//fluentPutAll 将map中的数据全部添加到JSONObject中</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject1</span> <span class="operator">=</span> jsonObject.fluentPutAll(map);</span><br><span class="line">        <span class="comment">//size 获取JSONObject的大小</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> jsonObject1.size();</span><br><span class="line">        System.out.println(size);</span><br><span class="line">        System.out.println(jsonObject1);</span><br><span class="line"></span><br><span class="line">        <span class="type">Student</span> <span class="variable">zhangsan</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;zhangsan&quot;</span>, <span class="string">&quot;1233123&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//toJSONString 将对象序列化成json字符串</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> jsonObject.toJSONString(zhangsan);</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//parseObject 将json字符串转换为指定的对象</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">jsonObject2</span> <span class="operator">=</span> jsonObject.parseObject(s);</span><br><span class="line">        System.out.println(jsonObject2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//containsKey判断是否有指定的key</span></span><br><span class="line">        <span class="type">Boolean</span> <span class="variable">i</span> <span class="operator">=</span> jsonObject.containsKey(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">        System.out.println(i);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//containsValue 判断JSONObject中是否有指定的value</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> jsonObject.containsValue(<span class="number">123</span>);</span><br><span class="line">        System.out.println(b);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//equals 判断两个对象是否相等</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">equals</span> <span class="operator">=</span> jsonObject.equals(map);</span><br><span class="line">        System.out.println(equals);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//isEmpty 判断JSONObject是否为空</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">empty</span> <span class="operator">=</span> jsonObject.isEmpty();</span><br><span class="line">        System.out.println(empty);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//clone 返回json对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">clone</span> <span class="operator">=</span> jsonObject.clone();</span><br><span class="line">        System.out.println(clone);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//values 获取JSONObject中的值(变为集合)</span></span><br><span class="line">        Collection&lt;Object&gt; values = jsonObject.values();</span><br><span class="line">        values.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//remove 移除指定的key-value对</span></span><br><span class="line">        jsonObject.remove(<span class="string">&quot;9&quot;</span>);</span><br><span class="line">        jsonObject.remove(<span class="string">&quot;8&quot;</span>,<span class="number">123d</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//clear 清空JSONObject数据</span></span><br><span class="line">        jsonObject.clear();</span><br><span class="line">        System.out.println(jsonObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">JSONArrayTest</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">JSONArray</span> <span class="variable">jsonArray</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONArray</span>();</span><br><span class="line">        <span class="type">Student</span> <span class="variable">student</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;zs&quot;</span>, <span class="string">&quot;have&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        jsonArray.add(student);</span><br><span class="line">        jsonArray.add(<span class="string">&quot;ubbleszones &quot;</span>);</span><br><span class="line">        String[] strings = &#123;<span class="string">&quot;zs&quot;</span>, <span class="string">&quot;have&quot;</span>&#125;;</span><br><span class="line">        jsonArray.add(strings);</span><br><span class="line">        jsonArray.addAll(Arrays.asList(strings));</span><br><span class="line">        jsonArray.add(<span class="string">&quot;ubbleszones &quot;</span>);</span><br><span class="line">        jsonArray.add(<span class="number">11L</span>);</span><br><span class="line">        jsonArray.add(<span class="number">11</span>);</span><br><span class="line">        jsonArray.add(<span class="number">11d</span>);</span><br><span class="line">        jsonArray.add(<span class="number">11f</span>);</span><br><span class="line">        jsonArray.add(<span class="literal">true</span>);</span><br><span class="line">        jsonArray.add(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">price</span> <span class="operator">=</span> BigDecimal.valueOf(<span class="number">3.145</span>);</span><br><span class="line">        jsonArray.add(price);</span><br><span class="line">        System.out.println(jsonArray);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// jsonArray[.stream()].toArray() 返回的是Object[] 类型的数组，但是可以转换成String[]</span></span><br><span class="line">        Object[] objects = jsonArray.toArray();</span><br><span class="line">        System.out.println(Arrays.toString(objects));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// size 获取JSONArray的大小</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> jsonArray.size();</span><br><span class="line">        System.out.println(size);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// jsonArray.get 返回指定下标的对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">string</span> <span class="operator">=</span> jsonArray.getString(<span class="number">1</span>);</span><br><span class="line">        System.out.println(string);</span><br><span class="line">        <span class="comment">//get 返回指定下标的对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> jsonArray.get(<span class="number">1</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o1</span> <span class="operator">=</span> jsonArray.get(<span class="number">2</span>);</span><br><span class="line">        System.out.println(o);</span><br><span class="line">        System.out.println(o1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// contains 判断jsonArray中是否有值为xxx的</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">contains</span> <span class="operator">=</span> jsonArray.contains(<span class="number">11</span>);</span><br><span class="line">        System.out.println(contains);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> jsonArray.containsAll(Arrays.asList(strings));</span><br><span class="line">        System.out.println(b);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//remove 移除指定下标的对象</span></span><br><span class="line">        jsonArray.remove(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">// remove 移除指定值为xxx的对象</span></span><br><span class="line">        jsonArray.remove(<span class="string">&quot;ubbleszones &quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// set 把对象放入指定下标的位置(有则替换，无则创建，原12现15，中间为null)</span></span><br><span class="line">        jsonArray.set(<span class="number">13</span>,<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.toString(jsonArray.toArray()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// clear 清空JSONArray数据</span></span><br><span class="line">        jsonArray.clear();</span><br><span class="line">        System.out.println(jsonArray);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/15/ES%EF%BC%88elasticsearch%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="河马">
      <meta itemprop="description" content="运气也是成功的一部分">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="河马窝苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/15/ES%EF%BC%88elasticsearch%EF%BC%89/" class="post-title-link" itemprop="url">ElasticSearch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-15 19:21:21 / 修改时间：19:27:04" itemprop="dateCreated datePublished" datetime="2023-08-15T19:21:21+08:00">2023-08-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>作用：</strong><br>可以帮助我们从海量数据中快速找到需要的内容<br><strong>小结：</strong><br>什么是elasticsearch？</p>
<ul>
<li>一个开源的分布式搜索引擎，可以用来实现搜索、日志统计、分析、系统监控等功能</li>
</ul>
<p>什么是elastic stack（ELK）？</p>
<ul>
<li>是以elasticsearch为核心的技术栈，包括beats、Logstash、kibana、elasticsearch</li>
</ul>
<p>什么是Lucene？（ELK就是基于它来做的二次开发）</p>
<ul>
<li>是Apache的开源搜索引擎类库，提供了搜索引擎的核心API</li>
</ul>
<h2 id="正向索引和倒排索引"><a href="#正向索引和倒排索引" class="headerlink" title="正向索引和倒排索引"></a>正向索引和倒排索引</h2><p>什么是文档和词条？</p>
<ul>
<li>每一条数据就是一个<strong>文档</strong>。</li>
<li>对文档中内容分词，得到的具备含义的词语就是<strong>词条</strong>。</li>
</ul>
<p>什么是<strong>正向索引</strong>？<br>基于文档id创建索引。查询词条时必须先找到文档，而后判断是否包含词条。<br>什么是<strong>倒排索引</strong>？<br>对文档内容分词，对词条创建索引，并记录词条所在文档的信息。查询时现根据词条查询到文档id，而后获取到文档。</p>
<h2 id="es中的概念"><a href="#es中的概念" class="headerlink" title="es中的概念"></a>es中的概念</h2><p>mysql与elasticsearch的概念对比：</p>
<table>
<thead>
<tr>
<th><strong>MySQL</strong></th>
<th><strong>Elasticsearch</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>Table</td>
<td>Index</td>
<td>索引(index)，就是文档的集合，类似数据库的表(table)</td>
</tr>
<tr>
<td>Row</td>
<td>Document</td>
<td>文档（Document），就是一条条的数据，类似数据库中的行（Row），文档都是JSON格式</td>
</tr>
<tr>
<td>Column</td>
<td>Field</td>
<td>字段（Field），就是JSON文档中的字段，类似数据库中的列（Column）</td>
</tr>
<tr>
<td>Schema</td>
<td>Mapping</td>
<td>Mapping（映射）是索引中文档的约束，例如字段类型约束。类似数据库的表结构（Schema）</td>
</tr>
<tr>
<td>SQL</td>
<td>DSL</td>
<td>DSL是elasticsearch提供的JSON风格的请求语句，用来操作elasticsearch，实现CRUD</td>
</tr>
</tbody></table>
<ul>
<li>Mysql：擅长事务类型操作，可以确保数据的安全和一致性</li>
<li>Elasticsearch：擅长海量数据的搜索、分析、计算</li>
</ul>
<h2 id="分词器"><a href="#分词器" class="headerlink" title="分词器"></a>分词器</h2><p>分词器的作用是什么？</p>
<ul>
<li>创建倒排索引时对文档分词</li>
<li>用户搜索时，对输入的内容分词</li>
</ul>
<p>IK分词器有几种模式？</p>
<ul>
<li>ik_smart：智能切分，粗粒度</li>
<li>ik_max_word：最细切分，细粒度</li>
</ul>
<p>IK分词器如何拓展词条？如何停用词条？</p>
<ul>
<li>利用config目录的IkAnalyzer.cfg.xml文件添加拓展词典和停用词典</li>
<li>在词典中添加拓展词条或者停用词条</li>
</ul>
<h2 id="CRUD"><a href="#CRUD" class="headerlink" title="CRUD"></a>CRUD</h2><p><strong>RestHighLevelClient</strong></p>
<h3 id="新增–IndexRequest"><a href="#新增–IndexRequest" class="headerlink" title="新增–IndexRequest"></a>新增–IndexRequest</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testAddDocument() throws IOException &#123;</span><br><span class="line">    // 1.根据id查询酒店数据</span><br><span class="line">    Hotel hotel = hotelService.getById(61083L);</span><br><span class="line">    // 2.转换为文档类型</span><br><span class="line">    HotelDoc hotelDoc = new HotelDoc(hotel);</span><br><span class="line">    // 3.将HotelDoc转json</span><br><span class="line">    String json = JSON.toJSONString(hotelDoc);</span><br><span class="line"></span><br><span class="line">    // 1.准备Request对象</span><br><span class="line">    IndexRequest request = new IndexRequest(&quot;hotel&quot;).id(hotelDoc.getId().toString());</span><br><span class="line">    // 2.准备Json文档</span><br><span class="line">    request.source(json, XContentType.JSON);</span><br><span class="line">    // 3.发送请求</span><br><span class="line">    client.index(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="更新–UpdateRequest"><a href="#更新–UpdateRequest" class="headerlink" title="更新–UpdateRequest"></a>更新–UpdateRequest</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testUpdateDocument() throws IOException &#123;</span><br><span class="line">    // 1.准备Request</span><br><span class="line">    UpdateRequest request = new UpdateRequest(&quot;hotel&quot;, &quot;61083&quot;);</span><br><span class="line">    // 2.准备请求参数</span><br><span class="line">    request.doc(</span><br><span class="line">        &quot;price&quot;, &quot;952&quot;,</span><br><span class="line">        &quot;starName&quot;, &quot;四钻&quot;</span><br><span class="line">    );</span><br><span class="line">    // 3.发送请求</span><br><span class="line">    client.update(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="删除–DeleteRequest"><a href="#删除–DeleteRequest" class="headerlink" title="删除–DeleteRequest"></a>删除–DeleteRequest</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testDeleteDocument() throws IOException &#123;</span><br><span class="line">    // 1.准备Request</span><br><span class="line">    DeleteRequest request = new DeleteRequest(&quot;hotel&quot;, &quot;61083&quot;);</span><br><span class="line">    // 2.发送请求</span><br><span class="line">    client.delete(request, RequestOptions.DEFAULT);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="按id查询–GetRequest"><a href="#按id查询–GetRequest" class="headerlink" title="按id查询–GetRequest"></a>按id查询–GetRequest</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">void testGetDocumentById() throws IOException &#123;</span><br><span class="line">    // 1.准备Request</span><br><span class="line">    GetRequest request = new GetRequest(&quot;hotel&quot;, &quot;61082&quot;);</span><br><span class="line">    // 2.发送请求，得到响应</span><br><span class="line">    GetResponse response = client.get(request, RequestOptions.DEFAULT);</span><br><span class="line">    // 3.解析响应结果</span><br><span class="line">    String json = response.getSourceAsString();</span><br><span class="line"></span><br><span class="line">    HotelDoc hotelDoc = JSON.parseObject(json, HotelDoc.class);</span><br><span class="line">    System.out.println(hotelDoc);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/15/MQ/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="河马">
      <meta itemprop="description" content="运气也是成功的一部分">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="河马窝苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/15/MQ/" class="post-title-link" itemprop="url">MQ</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-15 19:21:04 / 修改时间：19:28:12" itemprop="dateCreated datePublished" datetime="2023-08-15T19:21:04+08:00">2023-08-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a>MQ</h1><p><strong>端口15672</strong></p>
<h2 id="同步通讯"><a href="#同步通讯" class="headerlink" title="同步通讯"></a>同步通讯</h2><p>Feign调用就属于同步方式<br>同步调用的优点：</p>
<ul>
<li>时效性较强，可以立即得到结果</li>
</ul>
<p>同步调用的问题：</p>
<ul>
<li>耦合度高</li>
<li>性能和吞吐能力下降</li>
<li>有额外的资源消耗</li>
<li>有级联失败问题</li>
</ul>
<h2 id="异步通讯"><a href="#异步通讯" class="headerlink" title="异步通讯"></a>异步通讯</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1686056840612-968f664c-5c0a-41c1-a2ee-942d80856426.png#averageHue=%23e6d6cc&clientId=u7766641b-fe22-4&from=paste&height=107&id=u56320d9b&originHeight=134&originWidth=744&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=22356&status=done&style=none&taskId=u0decaeec-6b80-4694-bc55-0c483d5730f&title=&width=595.2" alt="image-20210422095356088.png"><br>中间多了一个Broker；<br>发布者发布事件到Broker，不关心谁来订阅事件。订阅者从Broker订阅事件，不关心谁发来的消息。<br><strong>好处：</strong></p>
<ul>
<li><strong>吞吐量提升：</strong>无需等待订阅者处理完成，响应更快速</li>
<li><strong>故障隔离：</strong>服务没有直接调用，不存在级联失败问题</li>
<li><strong>调用间没有阻塞</strong>，不会造成无效的资源占用</li>
<li><strong>耦合度极低</strong>，每个服务都可以灵活插拔，可替换</li>
<li><strong>流量削峰：</strong>不管发布事件的流量波动多大，都由Broker接收，订阅者可以按照自己的速度去处理事件</li>
</ul>
<p><strong>缺点：</strong></p>
<ul>
<li>架构复杂了，业务没有明显的流程线，不好管理</li>
<li>需要依赖于Broker的可靠、安全、性能</li>
</ul>
<p>MQ，中文是消息队列（MessageQueue），字面来看就是存放消息的队列。也就是事件驱动架构中的Broker。</p>
<h2 id="MQ的基本结构："><a href="#MQ的基本结构：" class="headerlink" title="MQ的基本结构："></a>MQ的基本结构：</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1686057486436-8ae43e6d-cb8c-439e-95dd-b356fac4ca55.png#averageHue=%23e8d7b3&clientId=u7766641b-fe22-4&from=paste&height=488&id=u276bf588&originHeight=610&originWidth=1401&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=99645&status=done&style=none&taskId=u05367bbb-e0d7-4301-93d7-0b3fe441500&title=&width=1120.8" alt="image-20210717162752376.png"><br>RabbitMQ中的一些角色：</p>
<ul>
<li>publisher：生产者</li>
<li>consumer：消费者</li>
<li>exchange个：交换机，负责消息路由</li>
<li>queue：队列，存储消息</li>
<li>virtualHost：虚拟主机，隔离不同租户的exchange、queue、消息的隔离</li>
</ul>
<h2 id="常见消息模型"><a href="#常见消息模型" class="headerlink" title="常见消息模型"></a>常见消息模型</h2><h2 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1686058169533-8e37edb4-257e-44e7-a64d-aa05fe86aece.png#averageHue=%23f8f5f5&clientId=ue13f5c2e-38e3-4&from=paste&height=572&id=uede952f9&originHeight=715&originWidth=1492&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=259847&status=done&style=none&taskId=u4b7cf135-2d90-418f-825b-8a2ec4f2758&title=&width=1193.6" alt="image-20210717163332646.png"></h2><h3 id="基本消息队列"><a href="#基本消息队列" class="headerlink" title="基本消息队列"></a>基本消息队列</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1686058219805-877874c6-9653-42bd-af79-4bf56dd543e4.png#averageHue=%23f6f3eb&clientId=ue13f5c2e-38e3-4&from=paste&height=172&id=u0aa02103&originHeight=215&originWidth=1247&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=39933&status=done&style=none&taskId=ub03eadfe-fc45-4b8b-abd6-2dc750872fb&title=&width=997.6" alt="image-20210717163434647.png"></p>
<h4 id="基本消息队列的消息发送流程："><a href="#基本消息队列的消息发送流程：" class="headerlink" title="基本消息队列的消息发送流程："></a>基本消息队列的消息发送流程：</h4><ol>
<li>建立connection</li>
<li>创建channel</li>
<li>利用channel声明队列</li>
<li>利用channel向队列发送消息</li>
</ol>
<h4 id="基本消息队列的消息接收流程："><a href="#基本消息队列的消息接收流程：" class="headerlink" title="基本消息队列的消息接收流程："></a>基本消息队列的消息接收流程：</h4><ol>
<li>建立connection</li>
<li>创建channel</li>
<li>利用channel声明队列</li>
<li>定义consumer的消费行为handleDelivery()</li>
<li>利用channel将消费者与队列绑定</li>
</ol>
<h1 id="SpringAMQP"><a href="#SpringAMQP" class="headerlink" title="SpringAMQP"></a>SpringAMQP</h1><p>SpringAMQP是基于RabbitMQ封装的一套模板，并且还利用SpringBoot对其实现了自动装配，使用起来非常方便。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1686059094623-2fd7aad5-0592-48c8-8e41-748aac001a9f.png#averageHue=%23eeeeee&clientId=u10f4d2e4-91de-4&from=paste&height=399&id=u1a222865&originHeight=499&originWidth=797&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=32449&status=done&style=none&taskId=ue90098c4-84c3-4c38-9048-b99b40ac113&title=&width=637.6" alt="image-20210717164024967.png"><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1686059102196-33ab306b-7ffd-4c14-9a15-7d9d337cb915.png#averageHue=%23ededed&clientId=u10f4d2e4-91de-4&from=paste&height=362&id=ub5f686ab&originHeight=453&originWidth=770&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=36902&status=done&style=none&taskId=u10d1901f-3e62-42cb-aac6-d55d1be977a&title=&width=616" alt="image-20210717164038678.png"><br>SpringAMQP提供了三个功能：</p>
<ul>
<li>自动声明队列、交换机及其绑定关系</li>
<li>基于注解的监听器模式，异步接收消息</li>
<li>封装了RabbitTemplate工具，用于发送消息</li>
</ul>
<h2 id="SpringAMQP使用过程"><a href="#SpringAMQP使用过程" class="headerlink" title="SpringAMQP使用过程"></a>SpringAMQP使用过程</h2><h3 id="BasicQueue（基本消息队列）"><a href="#BasicQueue（基本消息队列）" class="headerlink" title="BasicQueue（基本消息队列）"></a>BasicQueue（基本消息队列）</h3><h4 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--AMQP依赖，包含RabbitMQ--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h4 id="消息发送"><a href="#消息发送" class="headerlink" title="消息发送"></a>消息发送</h4><p>首先配置MQ地址，在publisher服务的application.yml中添加配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  rabbitmq:</span><br><span class="line">    host: 192.168.150.101 # 主机名</span><br><span class="line">    port: 5672 # 端口</span><br><span class="line">    virtual-host: / # 虚拟主机</span><br><span class="line">    username: itcast # 用户名</span><br><span class="line">    password: 123321 # 密码</span><br></pre></td></tr></table></figure>
<p>然后在publisher服务中编写测试类SpringAmqpTest，并利用RabbitTemplate实现消息发送：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mq.spring;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"><span class="keyword">import</span> org.junit.runner.RunWith;</span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.core.RabbitTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.test.context.junit4.SpringRunner;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line">    <span class="meta">@SpringBootTest</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringAmqpTest</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Autowired</span></span><br><span class="line">        <span class="keyword">private</span> RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Test</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSimpleQueue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="comment">// 队列名称</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line">            <span class="comment">// 消息</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, spring amqp!&quot;</span>;</span><br><span class="line">            <span class="comment">// 发送消息</span></span><br><span class="line">            rabbitTemplate.convertAndSend(<span class="string">&quot;&quot;</span>,queueName, message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="消息接收"><a href="#消息接收" class="headerlink" title="消息接收"></a>消息接收</h4><p>首先配置MQ地址，在consumer服务的application.yml中添加配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  rabbitmq:</span><br><span class="line">    host: 192.168.150.101 # 主机名</span><br><span class="line">    port: 5672 # 端口</span><br><span class="line">    virtual-host: / # 虚拟主机</span><br><span class="line">    username: itcast # 用户名</span><br><span class="line">    password: 123321 # 密码</span><br></pre></td></tr></table></figure>
<p>然后在consumer服务的cn.itcast.mq.listener包中新建一个类SpringRabbitListener，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cn.itcast.mq.listener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.amqp.rabbit.annotation.RabbitListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringRabbitListener</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenSimpleQueueMessage</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;spring 消费者接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><h5 id="发送"><a href="#发送" class="headerlink" title="发送"></a>发送</h5><ul>
<li>引入amqp的starter依赖</li>
<li>配置RabbitMQ地址</li>
<li>利用RabbitTemplate和convertAndSend方法</li>
</ul>
<h5 id="接收"><a href="#接收" class="headerlink" title="接收"></a>接收</h5><ul>
<li>引入amqp的starter依赖</li>
<li>配置RabbitMQ地址</li>
<li>定义类，添加@Compontent注解</li>
<li>类中声明方法，添加@RabbitListener注解，方法参数就是消息</li>
</ul>
<h3 id="WorkQueue"><a href="#WorkQueue" class="headerlink" title="WorkQueue"></a>WorkQueue</h3><p>Work queues，也被称为（Task queues），任务模型。简单来说就是<strong>让多个消费者绑定到一个队列，共同消费队列中的消息</strong>。</p>
<h4 id="-1"><a href="#-1" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1686059594290-696cf735-27bd-4cc2-b29e-6f6b6ce7ec66.png#averageHue=%23fdfafa&clientId=u10f4d2e4-91de-4&from=paste&height=377&id=u825469c4&originHeight=471&originWidth=1253&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=37081&status=done&style=none&taskId=ub2c210e2-fb47-41a3-a244-f9c00761ee4&title=&width=1002.4" alt="image-20210717164238910.png"></h4><p>消息发送<br>这次我们循环发送，模拟大量消息堆积现象。<br>在publisher服务中的SpringAmqpTest类中添加一个测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* workQueue</span></span><br><span class="line"><span class="comment">* 向队列中不停发送消息，模拟消息堆积。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testWorkQueue</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line"><span class="comment">// 队列名称</span></span><br><span class="line"><span class="type">String</span> <span class="variable">queueName</span> <span class="operator">=</span> <span class="string">&quot;simple.queue&quot;</span>;</span><br><span class="line"><span class="comment">// 消息</span></span><br><span class="line"><span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, message_&quot;</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">    <span class="comment">// 发送消息</span></span><br><span class="line">    rabbitTemplate.convertAndSend(queueName, message + i);</span><br><span class="line">    Thread.sleep(<span class="number">20</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消息接收-1"><a href="#消息接收-1" class="headerlink" title="消息接收"></a>消息接收</h4><h4 id="要模拟多个消费者绑定同一个队列，我们在consumer服务的SpringRabbitListener中添加2个新的方法："><a href="#要模拟多个消费者绑定同一个队列，我们在consumer服务的SpringRabbitListener中添加2个新的方法：" class="headerlink" title="要模拟多个消费者绑定同一个队列，我们在consumer服务的SpringRabbitListener中添加2个新的方法："></a>要模拟多个消费者绑定同一个队列，我们在consumer服务的SpringRabbitListener中添加2个新的方法：</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue1</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者1接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">        Thread.sleep(<span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(queues = &quot;simple.queue&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenWorkQueue2</span><span class="params">(String msg)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;消费者2........接收到消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span> + LocalTime.now());</span><br><span class="line">    Thread.sleep(<span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意到这个消费者sleep了1000秒，模拟任务耗时。</p>
<p>测试完毕后 发现  消息是平均分配每个消费者的 并没有<strong>能者多劳</strong><br>在spring中有一个简单的配置，可以解决这个问题。我们修改consumer服务的application.yml文件，添加配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  rabbitmq:</span><br><span class="line">    listener:</span><br><span class="line">      simple:</span><br><span class="line">        prefetch: 1 # 每次只能获取一条消息，处理完成才能获取下一个消息</span><br></pre></td></tr></table></figure>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><p>Work模型的使用：</p>
<ul>
<li>多个消费者绑定到一个队列，同一条消息只会被一个消费者处理</li>
<li>通过设置prefetch来控制消费者预取的消息数量</li>
</ul>
<h3 id="Publish-Subscribe-发布-订阅模式"><a href="#Publish-Subscribe-发布-订阅模式" class="headerlink" title="Publish&#x2F;Subscribe(发布&#x2F;订阅模式)"></a>Publish&#x2F;Subscribe(发布&#x2F;订阅模式)</h3><ul>
<li>Fanout：广播，将消息交给所有绑定到交换机的队列</li>
<li>Direct：定向，把消息交给符合指定routing key 的队列</li>
<li>Topic：通配符，把消息交给符合routing pattern（路由模式） 的队列</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1686104662626-1a6e2f1c-dd72-4509-9af8-14894e4238c6.png#averageHue=%23380000&clientId=u1e1f22d3-6d51-4&from=paste&id=u173bf3f4&originHeight=111&originWidth=434&originalType=url&ratio=1.25&rotation=0&showTitle=false&size=10928&status=done&style=none&taskId=ub708f53b-6cc4-4150-a8c1-369c8f13552&title=" alt="image.png"></p>
<h3 id="Fanout"><a href="#Fanout" class="headerlink" title="Fanout"></a>Fanout</h3><p>在广播模式下，消息发送流程是这样的：</p>
<ul>
<li>1） 可以有多个队列</li>
<li>2） 每个队列都要绑定到Exchange（交换机）</li>
<li>3） 生产者发送的消息，只能发送到交换机，交换机来决定要发给哪个队列，生产者无法决定</li>
<li>4） 交换机把消息发送给绑定过的所有队列</li>
<li>5） 订阅队列的消费者都能拿到消息</li>
</ul>
<h4 id="-2"><a href="#-2" class="headerlink" title=""></a></h4><p>声明队列和交换机</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">在consumer中创建一个类，声明队列和交换机：</span><br><span class="line"></span><br><span class="line">    <span class="keyword">package</span> cn.itcast.mq.config;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">import</span> org.springframework.amqp.core.Binding;</span><br><span class="line">    <span class="keyword">import</span> org.springframework.amqp.core.BindingBuilder;</span><br><span class="line">    <span class="keyword">import</span> org.springframework.amqp.core.FanoutExchange;</span><br><span class="line">    <span class="keyword">import</span> org.springframework.amqp.core.Queue;</span><br><span class="line">    <span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line">    <span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FanoutConfig</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 声明交换机</span></span><br><span class="line"><span class="comment">         * <span class="doctag">@return</span> Fanout类型交换机</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> FanoutExchange <span class="title function_">fanoutExchange</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FanoutExchange</span>(<span class="string">&quot;itcast.fanout&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 第1个队列</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue1</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue1&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 绑定队列和交换机</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Binding <span class="title function_">bindingQueue1</span><span class="params">(Queue fanoutQueue1, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 第2个队列</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Queue <span class="title function_">fanoutQueue2</span><span class="params">()</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Queue</span>(<span class="string">&quot;fanout.queue2&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 绑定队列和交换机</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Binding <span class="title function_">bindingQueue2</span><span class="params">(Queue fanoutQueue2, FanoutExchange fanoutExchange)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> BindingBuilder.bind(fanoutQueue2).to(fanoutExchange);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h4 id="消息发送-1"><a href="#消息发送-1" class="headerlink" title="消息发送"></a>消息发送</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">在publisher服务的SpringAmqpTest类中添加测试方法：</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFanoutExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 队列名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;itcast.fanout&quot;</span>;</span><br><span class="line">        <span class="comment">// 消息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;hello, everyone!&quot;</span>;</span><br><span class="line">        rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;&quot;</span>, message);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="消息接收-2"><a href="#消息接收-2" class="headerlink" title="消息接收"></a>消息接收</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在consumer服务的SpringRabbitListener中添加两个方法，作为消费者：</span><br><span class="line"></span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;fanout.queue1&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue1</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者1接收到Fanout消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@RabbitListener(queues = &quot;fanout.queue2&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenFanoutQueue2</span><span class="params">(String msg)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者2接收到Fanout消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><p>交换机的作用是什么？</p>
<ul>
<li>接收publisher发送的消息</li>
<li>将消息按照规则路由到与之绑定的队列</li>
<li>不能缓存消息，路由失败，消息丢失</li>
<li>FanoutExchange的会将消息路由到每个绑定的队列</li>
</ul>
<p>声明队列、交换机、绑定关系的Bean是什么？</p>
<ul>
<li>Queue</li>
<li>FanoutExchange</li>
<li>Binding</li>
</ul>
<h3 id="Direct"><a href="#Direct" class="headerlink" title="Direct"></a>Direct</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1686104799654-2abcd381-8eee-4331-9939-157cd5dc17d2.png#averageHue=%23140000&clientId=u1e1f22d3-6d51-4&from=paste&id=tINCU&originHeight=171&originWidth=423&originalType=url&ratio=1.25&rotation=0&showTitle=false&size=14754&status=done&style=none&taskId=ua22efb9e-929d-4ce5-9a82-3740115ac47&title=" alt="image.png"></p>
<h4 id="基于注解声明队列和交换机的消息接收"><a href="#基于注解声明队列和交换机的消息接收" class="headerlink" title="基于注解声明队列和交换机的消息接收"></a>基于注解声明队列和交换机的消息接收</h4><p>基于@Bean的方式声明队列和交换机比较麻烦，Spring还提供了基于注解方式来声明。<br>在consumer的SpringRabbitListener中添加两个消费者，同时基于注解来声明队列和交换机：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue1&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;blue&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue1</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;消费者接收到direct.queue1的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RabbitListener(bindings = @QueueBinding(</span></span><br><span class="line"><span class="meta">    value = @Queue(name = &quot;direct.queue2&quot;),</span></span><br><span class="line"><span class="meta">    exchange = @Exchange(name = &quot;itcast.direct&quot;, type = ExchangeTypes.DIRECT),</span></span><br><span class="line"><span class="meta">    key = &#123;&quot;red&quot;, &quot;yellow&quot;&#125;</span></span><br><span class="line"><span class="meta">))</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">listenDirectQueue2</span><span class="params">(String msg)</span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;消费者接收到direct.queue2的消息：【&quot;</span> + msg + <span class="string">&quot;】&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消息发送-2"><a href="#消息发送-2" class="headerlink" title="消息发送"></a>消息发送</h4><p>在publisher服务的SpringAmqpTest类中添加测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testSendDirectExchange</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 交换机名称</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">exchangeName</span> <span class="operator">=</span> <span class="string">&quot;itcast.direct&quot;</span>;</span><br><span class="line">        <span class="comment">// 消息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">message</span> <span class="operator">=</span> <span class="string">&quot;红色警报！日本乱排核废水，导致海洋生物变异，惊现哥斯拉！&quot;</span>;</span><br><span class="line">        <span class="comment">// 发送消息</span></span><br><span class="line">        rabbitTemplate.convertAndSend(exchangeName, <span class="string">&quot;red&quot;</span>, message);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-3"><a href="#总结-3" class="headerlink" title="总结"></a>总结</h4><p>基于@RabbitListener注解声明队列和交换机有哪些常见注解？</p>
<ul>
<li>@Queue</li>
<li>@Exchange</li>
</ul>
<h3 id="Topics（主题模式）"><a href="#Topics（主题模式）" class="headerlink" title="Topics（主题模式）"></a>Topics（主题模式）</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1686104825946-45d5929b-f787-473d-98a1-b9c8767eec4d.png#averageHue=%23140000&clientId=u1e1f22d3-6d51-4&from=paste&id=u0d1c9ea9&originHeight=171&originWidth=424&originalType=url&ratio=1.25&rotation=0&showTitle=false&size=13261&status=done&style=none&taskId=u296b1dbe-4f1d-46c8-85ea-9016f7abbdf&title=" alt="image.png"></p>
<h4 id="消息发送-3"><a href="#消息发送-3" class="headerlink" title="消息发送"></a>消息发送</h4><p>在publisher服务的SpringAmqpTest类中添加测试方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@Test</span><br><span class="line">public void testSendTopicExchange() &#123;</span><br><span class="line">    // 交换机名称</span><br><span class="line">    String exchangeName = &quot;itcast.topic&quot;;</span><br><span class="line">    // 消息</span><br><span class="line">    String message = &quot;喜报！孙悟空大战哥斯拉，胜!&quot;;</span><br><span class="line">    // 发送消息</span><br><span class="line">    rabbitTemplate.convertAndSend(exchangeName, &quot;china.news&quot;, message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="消息接收-3"><a href="#消息接收-3" class="headerlink" title="消息接收"></a>消息接收</h4><p>在consumer服务的SpringRabbitListener中添加方法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@RabbitListener(bindings = @QueueBinding(</span><br><span class="line">    value = @Queue(name = &quot;topic.queue1&quot;),</span><br><span class="line">    exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span><br><span class="line">    key = &quot;china.#&quot;</span><br><span class="line">))</span><br><span class="line">public void listenTopicQueue1(String msg)&#123;</span><br><span class="line">    System.out.println(&quot;消费者接收到topic.queue1的消息：【&quot; + msg + &quot;】&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@RabbitListener(bindings = @QueueBinding(</span><br><span class="line">    value = @Queue(name = &quot;topic.queue2&quot;),</span><br><span class="line">    exchange = @Exchange(name = &quot;itcast.topic&quot;, type = ExchangeTypes.TOPIC),</span><br><span class="line">    key = &quot;#.news&quot;</span><br><span class="line">))</span><br><span class="line">public void listenTopicQueue2(String msg)&#123;</span><br><span class="line">    System.out.println(&quot;消费者接收到topic.queue2的消息：【&quot; + msg + &quot;】&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="总结-4"><a href="#总结-4" class="headerlink" title="总结"></a>总结</h4><p>描述下Direct交换机与Topic交换机的差异？</p>
<ul>
<li>Topic交换机接收的消息RoutingKey必须是多个单词，以 <strong>.</strong> 分割</li>
<li>Topic交换机与队列绑定时的bindingKey可以指定通配符</li>
<li>#：代表0个或多个词</li>
<li>*：代表1个词</li>
</ul>
<h1 id="MQ高级"><a href="#MQ高级" class="headerlink" title="MQ高级"></a>MQ高级</h1><h2 id="消息可靠投递"><a href="#消息可靠投递" class="headerlink" title="消息可靠投递"></a>消息可靠投递</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/35579562/1686139015213-aa21f725-064d-4cac-9870-8d89bf0ead9e.jpeg"></p>
<h2 id="消息准确消费"><a href="#消息准确消费" class="headerlink" title="消息准确消费"></a>消息准确消费</h2><p><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/35579562/1686139474486-8cc93dc7-7f8b-4ee7-9425-50305ca8eb4d.jpeg"></p>
<h3 id="失败策略"><a href="#失败策略" class="headerlink" title="失败策略"></a>失败策略</h3><p>在之前的测试中，达到最大重试次数后，消息会被丢弃，这是由Spring内部机制决定的。<br>在开启重试模式后，重试次数耗尽，如果消息依然失败，则需要有MessageRecovery接口来处理，它包含三种不同的实现：</p>
<ul>
<li>RejectAndDontRequeueRecoverer：重试耗尽后，直接reject，丢弃消息。默认就是这种方式</li>
<li>ImmediateRequeueMessageRecoverer：重试耗尽后，返回nack，消息重新入队</li>
<li><strong>RepublishMessageRecoverer：重试耗尽后，将失败消息投递到指定的交换机</strong></li>
</ul>
<h2 id="死信交换机"><a href="#死信交换机" class="headerlink" title="死信交换机"></a>死信交换机</h2><p>什么样的消息会成为死信？</p>
<ul>
<li>消息被消费者reject或者返回nack</li>
<li>消息超时未消费</li>
<li>队列满了</li>
</ul>
<p>死信交换机的使用场景是什么？</p>
<ul>
<li>如果队列绑定了死信交换机，死信会投递到死信交换机；</li>
<li>可以利用死信交换机收集所有消费者处理失败的消息（死信），交由人工处理，进一步提高消息队列的可靠性。</li>
</ul>
<h2 id="TTL"><a href="#TTL" class="headerlink" title="TTL"></a>TTL</h2><p>一个队列中的消息如果超时未消费，则会变为死信，超时分为两种情况：</p>
<ul>
<li>消息所在的队列设置了超时时间</li>
<li>消息本身设置了超时时间</li>
</ul>
<p>消息超时的两种方式是？</p>
<ul>
<li>给队列设置ttl属性，进入队列后超过ttl时间的消息变为死信</li>
<li>给消息设置ttl属性，队列接收到消息超过ttl时间后变为死信</li>
</ul>
<p>如何实现发送一个消息20秒后消费者才收到消息？</p>
<ul>
<li>给消息的目标队列指定死信交换机</li>
<li>将消费者监听的队列绑定到死信交换机</li>
<li>发送消息时给消息设置超时时间为20秒</li>
</ul>
<h2 id="延时队列"><a href="#延时队列" class="headerlink" title="延时队列"></a>延时队列</h2><p>延迟队列插件的使用步骤包括哪些？<br>•声明一个交换机，添加delayed属性为true<br>•发送消息时，添加x-delay头，值为超时时间</p>
<h2 id="惰性队列"><a href="#惰性队列" class="headerlink" title="惰性队列"></a>惰性队列</h2><p>消息堆积问题的解决方案？</p>
<ul>
<li>队列上绑定多个消费者，提高消费速度</li>
<li>使用惰性队列，可以再mq中保存更多消息</li>
</ul>
<p>惰性队列的优点有哪些？</p>
<ul>
<li>基于磁盘存储，消息上限高</li>
<li>没有间歇性的page-out，性能比较稳定</li>
</ul>
<p>惰性队列的缺点有哪些？</p>
<ul>
<li>基于磁盘存储，消息时效性会降低</li>
<li>性能受限于磁盘的IO</li>
</ul>
<h2 id="MQ集群"><a href="#MQ集群" class="headerlink" title="MQ集群"></a>MQ集群</h2><p><strong>普通集群</strong>：是一种分布式集群，将队列分散到集群的各个节点，从而提高整个集群的并发能力。<br><strong>镜像集群</strong>：是一种主从集群，普通集群的基础上，添加了主从备份功能，提高集群的数据可用性。<br>镜像集群虽然支持主从，但主从同步并不是强一致的，某些情况下可能有数据丢失的风险。因此在RabbitMQ的3.8版本以后，推出了新的功能：<strong>仲裁队列</strong>来代替镜像集群，底层采用Raft协议确保主从的数据一致性。</p>
<h1 id="-3"><a href="#-3" class="headerlink" title=""></a></h1><p>MQ面试题<br><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/35579562/1686228981059-092100c6-f89b-47df-a0e6-b34545b06f42.jpeg"></p>
<p><img src="https://cdn.nlark.com/yuque/0/2023/jpeg/35579562/1686359224024-01d8388c-170a-4a47-8f28-22471fafcde9.jpeg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/15/MyBatisPlus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="河马">
      <meta itemprop="description" content="运气也是成功的一部分">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="河马窝苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/15/MyBatisPlus/" class="post-title-link" itemprop="url">MyBatisPlus</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-15 19:20:55 / 修改时间：19:31:04" itemprop="dateCreated datePublished" datetime="2023-08-15T19:20:55+08:00">2023-08-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.8k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a target="_blank" rel="noopener" href="https://baomidou.com/">https://baomidou.com/</a><br>查网址使用</p>
<h3 id="新知识点：MP对枚举类型数据是如何支持和使用的？"><a href="#新知识点：MP对枚举类型数据是如何支持和使用的？" class="headerlink" title="新知识点：MP对枚举类型数据是如何支持和使用的？"></a>新知识点：MP对枚举类型数据是如何支持和使用的？</h3><ol>
<li><p>注解方式：使用@EnumValue注解来标识该字段的枚举值在数据库中的存储方式，具体使用方法如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">GenderEnum</span> &#123;</span><br><span class="line">    MALE(<span class="number">1</span>, <span class="string">&quot;男&quot;</span>),</span><br><span class="line">    FEMALE(<span class="number">2</span>, <span class="string">&quot;女&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EnumValue</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String desc;</span><br><span class="line">    GenderEnum(<span class="type">int</span> code, String desc) &#123;</span><br><span class="line">        <span class="built_in">this</span>.code = code;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ... getters and setters ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在实体类中，将该枚举类型字段定义为枚举类，并使用@TableField注解来标识与数据库对应的字段名即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableField(&quot;gender_code&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> GenderEnum gender;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... getters and setters ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>类型处理器方式：在Mybatis中，我们可以通过自定义类型处理器来实现对枚举类型的支持。具体实现方法如下：</p>
</li>
</ol>
<p>自定义类型处理器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@MappedTypes(GenderEnum.class)</span></span><br><span class="line"><span class="meta">@MappedJdbcTypes(JdbcType.INTEGER)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GenderEnumTypeHandler</span> <span class="keyword">extends</span> <span class="title class_">BaseTypeHandler</span>&lt;GenderEnum&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNonNullParameter</span><span class="params">(PreparedStatement ps, <span class="type">int</span> i, GenderEnum parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        ps.setInt(i, parameter.getCode());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> GenderEnum <span class="title function_">getNullableResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> rs.getInt(columnName);</span><br><span class="line">        <span class="keyword">return</span> code == <span class="number">0</span> &amp;&amp; rs.wasNull() ? <span class="literal">null</span> : GenderEnum.getEnumByCode(code);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> GenderEnum <span class="title function_">getNullableResult</span><span class="params">(ResultSet rs, <span class="type">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> rs.getInt(columnIndex);</span><br><span class="line">        <span class="keyword">return</span> code == <span class="number">0</span> &amp;&amp; rs.wasNull() ? <span class="literal">null</span> : GenderEnum.getEnumByCode(code);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> GenderEnum <span class="title function_">getNullableResult</span><span class="params">(CallableStatement cs, <span class="type">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">code</span> <span class="operator">=</span> cs.getInt(columnIndex);</span><br><span class="line">        <span class="keyword">return</span> code == <span class="number">0</span> &amp;&amp; cs.wasNull() ? <span class="literal">null</span> : GenderEnum.getEnumByCode(code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在Mybatis的配置文件中，将该类型处理器注册到类型处理器列表中即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeHandlers&gt;</span><br><span class="line">    &lt;typeHandler handler=<span class="string">&quot;com.example.handler.GenderEnumTypeHandler&quot;</span>/&gt;</span><br><span class="line">&lt;/typeHandlers&gt;</span><br></pre></td></tr></table></figure>
<p>注册后，我们在实体类中定义枚举类型字段，然后使用@TableField注解标识数据库字段名：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@TableField(&quot;gender_code&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> GenderEnum gender;</span><br><span class="line">    <span class="comment">// ... getters and setters ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样，MybatisPlus便可以自动将数据库中的枚举值映射为Java中的枚举类型。</p>
<h3 id="新知识点：MP对逻辑删除字段值的处理？"><a href="#新知识点：MP对逻辑删除字段值的处理？" class="headerlink" title="新知识点：MP对逻辑删除字段值的处理？"></a>新知识点：MP对逻辑删除字段值的处理？</h3><ol>
<li>标记逻辑删除字段</li>
</ol>
<p>在实体类中，我们可以使用@TableLogic注解来标识逻辑删除字段，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TableLogic</span></span><br><span class="line">    <span class="keyword">private</span> Integer deleted; <span class="comment">// 标记逻辑删除字段</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... getters and setters ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当我们进行删除操作时，MybatisPlus会将deleted字段的值设置为逻辑删除标识（默认为1），而不是直接删除该记录。</p>
<ol start="2">
<li>全局配置逻辑删除属性</li>
</ol>
<p>MybatisPlus还提供了全局配置逻辑删除的属性，可以通过在MybatisPlusConfig类中配置，如下所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisPlusConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MybatisPlusInterceptor <span class="title function_">mybatisPlusInterceptor</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MybatisPlusInterceptor</span> <span class="variable">interceptor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MybatisPlusInterceptor</span>();</span><br><span class="line">        <span class="comment">// 全局配置逻辑删除属性</span></span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> <span class="title class_">MybatisPlusInnerInterceptor</span>(<span class="keyword">new</span> <span class="title class_">LogicSqlInjector</span>(), <span class="keyword">new</span> <span class="title class_">DefaultSqlParserHandler</span>(), <span class="keyword">new</span> <span class="title class_">LogicSqlConfig</span>().setLogicDeleteField(<span class="string">&quot;deleted&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过配置LogicSqlConfig类的logicDeleteField属性，我们可以指定全局逻辑删除字段的名称，默认为deleted。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4(sentinel)/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="河马">
      <meta itemprop="description" content="运气也是成功的一部分">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="河马窝苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/15/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%BF%9D%E6%8A%A4(sentinel)/" class="post-title-link" itemprop="url">微服务保护（sentinel）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-15 19:20:45 / 修改时间：19:26:03" itemprop="dateCreated datePublished" datetime="2023-08-15T19:20:45+08:00">2023-08-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>992</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="雪崩问题"><a href="#雪崩问题" class="headerlink" title="雪崩问题"></a>雪崩问题</h1><p>微服务调用链路中的某个服务故障引起整个链路中的所有微服务都不可用，这就叫做雪崩</p>
<h3 id="解决方式："><a href="#解决方式：" class="headerlink" title="解决方式："></a>解决方式：</h3><p><strong>超时处理：</strong>设定超时时间，请求超过一定时间没有响应就返回错误信息，不会无休止等待<br><strong>仓壁模式：</strong>限定每个业务能使用的线程数，避免耗尽整个tomcat的资源，也叫线程隔离。<br><strong>熔断降级（断路器模式）：</strong>由<strong>断路器</strong>统计业务执行的异常比例，如果超出阈值则会<strong>熔断</strong>该业务，拦截访问该业务的一切请求。<br><strong>流量控制</strong>：限制业务访问的QPS，避免服务因流量的突增而故障。——预防雪崩</p>
<h1 id="sentinel限流的方式"><a href="#sentinel限流的方式" class="headerlink" title="sentinel限流的方式"></a>sentinel限流的方式</h1><ul>
<li>直接：统计当前资源的请求，触发阈值时对当前资源直接限流，也是默认的模式</li>
<li>关联：统计与当前资源A相关的另一个资源B，触发阈值时，对当前资源限流</li>
<li>链路：统计从指定链路访问到本资源的请求，触发阈值时，对指定链路限流</li>
</ul>
<h1 id="信号量隔离-线程池隔离的区别"><a href="#信号量隔离-线程池隔离的区别" class="headerlink" title="信号量隔离&#x2F;线程池隔离的区别"></a>信号量隔离&#x2F;线程池隔离的区别</h1><p>线程隔离的两种手段是？</p>
<ul>
<li>信号量隔离</li>
<li>线程池隔离</li>
</ul>
<p>信号量隔离的特点是？</p>
<ul>
<li>基于计数器模式，简单，开销小</li>
</ul>
<p>线程池隔离的特点是？</p>
<ul>
<li>基于线程池模式，有额外开销，但隔离控制更强</li>
</ul>
<h1 id="如何配置某下游资源的信号量"><a href="#如何配置某下游资源的信号量" class="headerlink" title="如何配置某下游资源的信号量"></a>如何配置某下游资源的信号量</h1><p>找到feign接口，添加流控，选择线程数，设置其阈值</p>
<h1 id="熔断的过程，知道如何配置熔断规则"><a href="#熔断的过程，知道如何配置熔断规则" class="headerlink" title="熔断的过程，知道如何配置熔断规则"></a>熔断的过程，知道如何配置熔断规则</h1><p>熔断降级是解决雪崩问题的重要手段。其思路是由<strong>断路器</strong>统计服务调用的异常比例、慢请求比例，如果超出阈值则会<strong>熔断</strong>该服务。即拦截访问该服务的一切请求；而当服务恢复时，断路器会放行访问该服务的请求。<br>断路器控制熔断和放行是通过状态机来完成的：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1685787853474-f5064aa5-a847-4bf2-90ed-af5882d42d29.png#averageHue=%23faf4f1&clientId=u2f4c1f77-7798-4&from=paste&height=379&id=u9e6517cc&originHeight=474&originWidth=1421&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=44379&status=done&style=none&taskId=u61bccd9e-cd89-4be0-b08c-95b92ec8fde&title=&width=1136.8" alt="image-20210716130958518.png"><br>状态机包括三个状态：</p>
<ul>
<li>closed：关闭状态，断路器放行所有请求，并开始统计异常比例、慢请求比例。超过阈值则切换到open状态</li>
<li>open：打开状态，服务调用被<strong>熔断</strong>，访问被熔断服务的请求会被拒绝，快速失败，直接走降级逻辑。Open状态5秒后会进入half-open状态</li>
<li>half-open：半开状态，放行一次请求，根据执行结果来判断接下来的操作。<ul>
<li>请求成功：则切换到closed状态</li>
<li>请求失败：则切换到open状态</li>
</ul>
</li>
</ul>
<h1 id="sentinel熔断的规则"><a href="#sentinel熔断的规则" class="headerlink" title="sentinel熔断的规则"></a>sentinel熔断的规则</h1><p>断路器熔断策略有三种：<strong>慢调用</strong>、<strong>异常比例</strong>、<strong>异常数</strong></p>
<h3 id="慢调用"><a href="#慢调用" class="headerlink" title="慢调用"></a>慢调用</h3><p><strong>慢调用</strong>：业务的响应时长（RT）大于指定时长的请求认定为慢调用请求。在指定时间内，如果请求数量超过设定的最小数量，慢调用比例大于设定的阈值，则触发熔断。</p>
<h3 id="异常比例、异常数"><a href="#异常比例、异常数" class="headerlink" title="异常比例、异常数"></a>异常比例、异常数</h3><p><strong>异常比例或异常数</strong>：统计指定时间内的调用，如果调用次数超过指定请求数，并且出现异常的比例达到设定的比例阈值（或超过指定异常数），则触发熔断。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/15/%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3GateWay/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="河马">
      <meta itemprop="description" content="运气也是成功的一部分">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="河马窝苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/15/%E7%BB%9F%E4%B8%80%E7%BD%91%E5%85%B3GateWay/" class="post-title-link" itemprop="url">GateWay</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-15 19:20:35 / 修改时间：19:28:32" itemprop="dateCreated datePublished" datetime="2023-08-15T19:20:35+08:00">2023-08-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>5 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>网关的<strong>核心功能特性（作用）</strong>：</p>
<ul>
<li>请求路由</li>
<li>权限控制</li>
<li>限流</li>
</ul>
<p>网关：服务请求调度&amp;过滤服务组件！ spring-cloud-gateway</p>
<h2 id="搭建网关微服务"><a href="#搭建网关微服务" class="headerlink" title="搭建网关微服务"></a>搭建网关微服务</h2><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--网关--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br><span class="line">&lt;!--nacos服务发现依赖--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-discovery<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="编写启动类"><a href="#编写启动类" class="headerlink" title="编写启动类"></a>编写启动类</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">package cn.<span class="property">itcast</span>.<span class="property">gateway</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">SpringApplication</span>;</span><br><span class="line"><span class="keyword">import</span> org.<span class="property">springframework</span>.<span class="property">boot</span>.<span class="property">autoconfigure</span>.<span class="property">SpringBootApplication</span>;</span><br><span class="line"></span><br><span class="line">@<span class="title class_">SpringBootApplication</span></span><br><span class="line">public <span class="keyword">class</span> <span class="title class_">GatewayApplication</span> &#123;</span><br><span class="line"></span><br><span class="line">	public <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>) &#123;</span><br><span class="line">		<span class="title class_">SpringApplication</span>.<span class="title function_">run</span>(<span class="title class_">GatewayApplication</span>.<span class="property">class</span>, args);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="编写基础配置和路由规则"><a href="#编写基础配置和路由规则" class="headerlink" title="编写基础配置和路由规则"></a>编写基础配置和路由规则</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server</span>:</span><br><span class="line">  <span class="attr">port</span>: <span class="number">10010</span> # 网关端口</span><br><span class="line"><span class="attr">spring</span>:</span><br><span class="line">  <span class="attr">application</span>:</span><br><span class="line">    <span class="attr">name</span>: gateway # 服务名称</span><br><span class="line">  <span class="attr">cloud</span>:</span><br><span class="line">    <span class="attr">nacos</span>:</span><br><span class="line">      server-<span class="attr">addr</span>: <span class="attr">localhost</span>:<span class="number">8848</span> # nacos地址</span><br><span class="line">    <span class="attr">gateway</span>:</span><br><span class="line">      <span class="attr">routes</span>: # 网关路由配置</span><br><span class="line">        - <span class="attr">id</span>: user-service # 路由id，自定义，只要唯一即可</span><br><span class="line">          # <span class="attr">uri</span>: <span class="attr">http</span>:<span class="comment">//127.0.0.1:8081 # 路由的目标地址 http就是固定地址</span></span><br><span class="line">          <span class="attr">uri</span>: <span class="attr">lb</span>:<span class="comment">//userservice # 路由的目标地址 lb就是负载均衡，后面跟服务名称</span></span><br><span class="line">          <span class="attr">predicates</span>: # 路由断言，也就是判断请求是否符合路由规则的条件</span><br><span class="line">            - <span class="title class_">Path</span>=<span class="regexp">/user/</span>** # 这个是按照路径匹配，只要以/user/开头就符合要求</span><br></pre></td></tr></table></figure>
<h2 id="断言工厂"><a href="#断言工厂" class="headerlink" title="断言工厂"></a>断言工厂</h2><p>断言工厂在SpringCloudGateway还有十几个:</p>
<table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>说明</strong></th>
<th><strong>示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>After</td>
<td>是某个时间点后的请求</td>
<td>- After&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver]</td>
</tr>
<tr>
<td>Before</td>
<td>是某个时间点之前的请求</td>
<td>- Before&#x3D;2031-04-13T15:14:47.433+08:00[Asia&#x2F;Shanghai]</td>
</tr>
<tr>
<td>Between</td>
<td>是某两个时间点之前的请求</td>
<td>- Between&#x3D;2037-01-20T17:42:47.789-07:00[America&#x2F;Denver], 2037-01-21T17:42:47.789-07:00[America&#x2F;Denver]</td>
</tr>
<tr>
<td>Cookie</td>
<td>请求必须包含某些cookie</td>
<td>- Cookie&#x3D;chocolate, ch.p</td>
</tr>
<tr>
<td>Header</td>
<td>请求必须包含某些header</td>
<td>- Header&#x3D;X-Request-Id, \d+</td>
</tr>
<tr>
<td>Host</td>
<td>请求必须是访问某个host（域名）</td>
<td>- Host&#x3D;<strong>.somehost.org,</strong>.anotherhost.org</td>
</tr>
<tr>
<td>Method</td>
<td>请求方式必须是指定方式</td>
<td>- Method&#x3D;GET,POST</td>
</tr>
<tr>
<td>Path</td>
<td>请求路径必须符合指定规则</td>
<td>- Path&#x3D;&#x2F;red&#x2F;{segment},&#x2F;blue&#x2F;**</td>
</tr>
<tr>
<td>Query</td>
<td>请求参数必须包含指定参数</td>
<td>- Query&#x3D;name, Jack或者- Query&#x3D;name</td>
</tr>
<tr>
<td>RemoteAddr</td>
<td>请求者的ip必须是指定范围</td>
<td>- RemoteAddr&#x3D;192.168.1.1&#x2F;24</td>
</tr>
<tr>
<td>Weight</td>
<td>权重处理</td>
<td></td>
</tr>
</tbody></table>
<h2 id="过滤器工厂"><a href="#过滤器工厂" class="headerlink" title="过滤器工厂"></a>过滤器工厂</h2><h3 id="路由过滤器的种类"><a href="#路由过滤器的种类" class="headerlink" title="路由过滤器的种类"></a>路由过滤器的种类</h3><table>
<thead>
<tr>
<th><strong>名称</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td>AddRequestHeader</td>
<td>给当前请求添加一个请求头</td>
</tr>
<tr>
<td>RemoveRequestHeader</td>
<td>移除请求中的一个请求头</td>
</tr>
<tr>
<td>AddResponseHeader</td>
<td>给响应结果中添加一个响应头</td>
</tr>
<tr>
<td>RemoveResponseHeader</td>
<td>从响应结果中移除有一个响应头</td>
</tr>
<tr>
<td>RequestRateLimiter</td>
<td>限制请求的流量</td>
</tr>
</tbody></table>
<h3 id="请求头过滤器"><a href="#请求头过滤器" class="headerlink" title="请求头过滤器"></a>请求头过滤器</h3><p>修改gateway服务的application.yml文件，添加路由过滤即可：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring</span>:</span><br><span class="line">  <span class="attr">cloud</span>:</span><br><span class="line">    <span class="attr">gateway</span>:</span><br><span class="line">      <span class="attr">routes</span>:</span><br><span class="line">      - <span class="attr">id</span>: user-service </span><br><span class="line">        <span class="attr">uri</span>: <span class="attr">lb</span>:<span class="comment">//userservice </span></span><br><span class="line">        <span class="attr">predicates</span>: </span><br><span class="line">        - <span class="title class_">Path</span>=<span class="regexp">/user/</span>** </span><br><span class="line">        <span class="attr">filters</span>: # 过滤器</span><br><span class="line">        - <span class="title class_">AddRequestHeader</span>=<span class="title class_">Truth</span>, <span class="title class_">Itcast</span> is freaking awesome! # 添加请求头</span><br></pre></td></tr></table></figure>
<p>当前过滤器写在userservice路由下，因此仅仅对访问userservice的请求有效。</p>
<h3 id="默认过滤器"><a href="#默认过滤器" class="headerlink" title="默认过滤器"></a>默认过滤器</h3><p>对所有的路由都生效，则可以将过滤器工厂写到default下。格式如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring</span>:</span><br><span class="line">  <span class="attr">cloud</span>:</span><br><span class="line">    <span class="attr">gateway</span>:</span><br><span class="line">      <span class="attr">routes</span>:</span><br><span class="line">      - <span class="attr">id</span>: user-service </span><br><span class="line">        <span class="attr">uri</span>: <span class="attr">lb</span>:<span class="comment">//userservice </span></span><br><span class="line">        <span class="attr">predicates</span>: </span><br><span class="line">        - <span class="title class_">Path</span>=<span class="regexp">/user/</span>**</span><br><span class="line">      <span class="keyword">default</span>-<span class="attr">filters</span>: # 默认过滤项</span><br><span class="line">      - <span class="title class_">AddRequestHeader</span>=<span class="title class_">Truth</span>, <span class="title class_">Itcast</span> is freaking awesome! </span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>过滤器的作用是什么？<br>① 对路由的请求或响应做加工处理，比如添加请求头<br>② 配置在路由下的过滤器只对当前路由的请求生效<br>defaultFilters的作用是什么？<br>① 对所有路由都生效的过滤器</p>
<h2 id="全局过滤器"><a href="#全局过滤器" class="headerlink" title="全局过滤器"></a>全局过滤器</h2><p>全局过滤器的作用也是处理一切进入网关的请求和微服务响应，与GatewayFilter的作用一样。区别在于GatewayFilter通过配置定义，处理逻辑是固定的；而GlobalFilter的逻辑需要自己写代码实现。<br>定义方式是实现GlobalFilter接口。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">GlobalFilter</span> &#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">*  处理当前请求，有必要的话通过&#123;<span class="doctag">@link</span> GatewayFilterChain&#125;将请求交给下一个过滤器处理</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> exchange 请求上下文，里面可以获取Request、Response等信息</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> chain 用来把请求委托给下一个过滤器 </span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> Mono&lt;Void&gt;&#125; 返回标示当前过滤器业务结束</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    Mono&lt;Void&gt; <span class="title function_">filter</span><span class="params">(ServerWebExchange exchange, GatewayFilterChain chain)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在filter中编写自定义逻辑，可以实现下列功能：</p>
<ul>
<li>登录状态判断</li>
<li>权限校验</li>
<li>请求限流等</li>
</ul>
<h3 id="自定义全局过滤器"><a href="#自定义全局过滤器" class="headerlink" title="自定义全局过滤器"></a>自定义全局过滤器</h3><p>需求：定义全局过滤器，拦截请求，判断请求的参数是否满足下面条件：</p>
<ul>
<li>参数中是否有authorization，</li>
<li>authorization参数值是否为admin</li>
</ul>
<p>如果同时满足则放行，否则拦截<br>实现：<br>在gateway中定义一个过滤器：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">package cn.itcast.gateway.filters;</span><br><span class="line"></span><br><span class="line">import org.springframework.cloud.gateway.filter.GatewayFilterChain;</span><br><span class="line">import org.springframework.cloud.gateway.filter.GlobalFilter;</span><br><span class="line">import org.springframework.core.annotation.Order;</span><br><span class="line">import org.springframework.http.HttpStatus;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.server.ServerWebExchange;</span><br><span class="line">import reactor.core.publisher.Mono;</span><br><span class="line"></span><br><span class="line">@Order(-1)</span><br><span class="line">@Component</span><br><span class="line">public class AuthorizeFilter implements GlobalFilter &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public Mono&lt;Void&gt; filter(ServerWebExchange exchange, GatewayFilterChain chain) &#123;</span><br><span class="line">        // 1.获取请求参数</span><br><span class="line">        MultiValueMap&lt;String, String&gt; params = exchange.getRequest().getQueryParams();</span><br><span class="line">        // 2.获取authorization参数</span><br><span class="line">        String auth = params.getFirst(&quot;authorization&quot;);</span><br><span class="line">        // 3.校验</span><br><span class="line">        if (&quot;admin&quot;.equals(auth)) &#123;</span><br><span class="line">            // 放行</span><br><span class="line">            return chain.filter(exchange);</span><br><span class="line">        &#125;</span><br><span class="line">        // 4.拦截</span><br><span class="line">        // 4.1.禁止访问，设置状态码</span><br><span class="line">        exchange.getResponse().setStatusCode(HttpStatus.FORBIDDEN);</span><br><span class="line">        // 4.2.结束处理</span><br><span class="line">        return exchange.getResponse().setComplete();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="过滤器执行顺序"><a href="#过滤器执行顺序" class="headerlink" title="过滤器执行顺序"></a>过滤器执行顺序</h3><ul>
<li>defaultFilter &gt; 路由过滤器 &gt; GlobalFilter。</li>
</ul>
<h2 id="跨域问题"><a href="#跨域问题" class="headerlink" title="跨域问题"></a>跨域问题</h2><p>跨域：域名不一致就是跨域，主要包括：</p>
<ul>
<li>域名不同： <a target="_blank" rel="noopener" href="https://www.taobao.com/">www.taobao.com</a> 和 <a target="_blank" rel="noopener" href="https://www.taobao.org/">www.taobao.org</a> 和 <a target="_blank" rel="noopener" href="https://www.jd.com/">www.jd.com</a> 和 miaosha.jd.com</li>
<li>域名相同，端口不同：localhost:8080和localhost8081</li>
</ul>
<p>跨域问题：浏览器禁止请求的发起者与服务端发生跨域ajax请求，请求被浏览器拦截的问题<br>解决方案：CORS，这个以前应该学习过，这里不再赘述了。不知道的小伙伴可以查看<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2016/04/cors.html">https://www.ruanyifeng.com/blog/2016/04/cors.html</a></p>
<h3 id="解决跨域问题"><a href="#解决跨域问题" class="headerlink" title="解决跨域问题"></a>解决跨域问题</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">在gateway服务的application.yml文件中，添加下面的配置：</span><br><span class="line"></span><br><span class="line">    spring:</span><br><span class="line">      cloud:</span><br><span class="line">        gateway:</span><br><span class="line">          globalcors: # 全局的跨域处理</span><br><span class="line">            add-to-simple-url-handler-mapping: <span class="literal">true</span> # 解决options请求被拦截问题</span><br><span class="line">            corsConfigurations:</span><br><span class="line">              <span class="string">&#x27;[/**]&#x27;</span>:</span><br><span class="line">                allowedOrigins:  # 允许哪些网站的跨域请求</span><br><span class="line">                  - <span class="string">&quot;http://localhost:8080&quot;</span></span><br><span class="line">                allowedMethods: # 允许的跨域ajax的请求方式</span><br><span class="line">                  - <span class="string">&quot;GET&quot;</span></span><br><span class="line">                  - <span class="string">&quot;POST&quot;</span></span><br><span class="line">                  - <span class="string">&quot;DELETE&quot;</span></span><br><span class="line">                  - <span class="string">&quot;PUT&quot;</span></span><br><span class="line">                  - <span class="string">&quot;OPTIONS&quot;</span></span><br><span class="line">                allowedHeaders: <span class="string">&quot;*&quot;</span> # 允许在请求中携带任意的头信息</span><br><span class="line">                allowCredentials: <span class="literal">true</span> # 是否允许携带cookie</span><br><span class="line">                maxAge: <span class="number">360000</span> # 这次跨域检测的有效期</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/15/CAP%E5%AE%9A%E7%90%86&&BASE%E7%90%86%E8%AE%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="河马">
      <meta itemprop="description" content="运气也是成功的一部分">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="河马窝苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/15/CAP%E5%AE%9A%E7%90%86&&BASE%E7%90%86%E8%AE%BA/" class="post-title-link" itemprop="url">CAP和BASE</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-15 19:20:25 / 修改时间：19:31:36" itemprop="dateCreated datePublished" datetime="2023-08-15T19:20:25+08:00">2023-08-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CAP定理"><a href="#CAP定理" class="headerlink" title="CAP定理"></a>CAP定理</h1><p>CAP定理，也称CAP原则，是计算机网络中一个重要的理论概念。它指出，分布式系统中的三个要素：<strong>一致性（Consistency）</strong>、<strong>可用性（Availability）</strong>和<strong>分区容错性（Partition tolerance）</strong>这三个要素中，最多只能同时满足其中两个。<br>这三个性质对应了分布式系统的三个指标：<br>而CAP理论说的就是：一个分布式系统，不可能同时做到这三点。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1685532840632-8abe3aa8-2c4e-44ec-922b-78916b14f0e4.png#averageHue=%23fbfbfb&clientId=u9d407055-3c78-4&from=paste&id=uc637f979&originHeight=348&originWidth=444&originalType=url&ratio=1.25&rotation=0&showTitle=false&size=83217&status=done&style=none&taskId=u65f5d723-6b6a-462d-9b7a-a9e8b847f52&title=" alt="image.png"><br>①<strong>一致性C：</strong>对于客户端的每次读操作，要么读到的是最新的数据，要么读取失败。换句话说，一致性是站在分布式系统的角度，对访问本系统的客户端的一种承诺：要么我给您返回一个错误，要么我给你返回绝对一致的<strong>最新数据</strong>，不难看出，其<strong>强调的是数据正确</strong>。<br>②<strong>可用性A：</strong>任何客户端的请求都能得到响应数据，不会出现响应错误。换句话说，可用性是站在分布式系统的角度，对访问本系统的客户的另一种承诺：我一定会给您返回数据，不会给你返回错误，但<strong>不保证数据最新</strong>，<strong>强调的是不出错</strong>。<br>③<strong>分区容错性P：</strong>由于分布式系统通过网络进行通信，网络是不可靠的。当任意数量的消息丢失或延迟到达时，系统仍会继续提供服务，不会挂掉。换句话说，分区容忍性是站在分布式系统的角度，对访问本系统的客户端的再一种承诺：我会一直运行，不管我的内部出现何种数据同步问题，<strong>强调的是不挂掉</strong>。</p>
<h1 id="BASE理论"><a href="#BASE理论" class="headerlink" title="BASE理论"></a>BASE理论</h1><p>根据CAP，我们分布式共享数据的系统，要实现CP，就需要牺牲可用性；如果实现AP，则牺牲了一致性。对于大型应用来说，我们除非涉及到资金等严格要求一致性的场景，大部分我们都选择AP，即保留可用性和分区容错性，但是我们也不一定完全牺牲掉一致性，我们可以对一致性做个柔性的变动，不要求立刻一致，可以在一定时间内达到一致即可，使用BASE理论可以达到这个目的。</p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>BASE理论是由eBay工程师提出，是对<strong>可用性</strong>和<strong>一致性</strong>的权衡。BASE是由 Basically Available(基本可用)，Soft state（软状态）,和 Eventually consistent（最终一致性）三个短语的缩写。</p>
<h3 id="Basically-Available-基本可用"><a href="#Basically-Available-基本可用" class="headerlink" title="Basically Available(基本可用)"></a>Basically Available(基本可用)</h3><p>算作完全可用和完全不可用中的一种折中，互联网上的应用，如果是完全不可用的，那这个系统就没存在必要了；而在互联网上，用户量等有时候难以预见，就造成了用户超出系统设计的标准，想一直保持完全可用就很难，所以折中下，我们可以通过<strong>延迟响应</strong>，<strong>流量削峰</strong>等手段来保障系统的核心功能的正常，从而实现基本可用。</p>
<h3 id="Eventually-consistent-最终一致性"><a href="#Eventually-consistent-最终一致性" class="headerlink" title="Eventually consistent(最终一致性)"></a>Eventually consistent(最终一致性)</h3><p>我们希望获取的数据就是正确的，这像一句废话，如果获取到的数据是不确定正确与否，那我们拿这些错误的数据干嘛。但是由于这样那样的问题，我们不能随时都保障数据的一致，所以我们有了数据的中间状态，即软状态，经过一定时间后，数据最终回归于最终一致，这些短暂的数据不一致性，对用户的影响很小，比如你更新一条微博动态，可能有的地方用户可以看到你这条微博消息，另外的用户看不到这条微博消息，这个影响不大，只要最终所有用户都可以看到你这条微博消息就可以了。<br>最终一致性的系统不承诺写入数据成功后，立刻就从系统中读出最新的数据，也不承诺具体多久之后可以读到最新的数据，而是尽可能保障特定时间级别之后的数据可用，这取决于很多因素，比如网络快慢，比如副本的多少等。如果我们设置过DNS域名就知道，DNS域名我们配置A记录后，域名和IP的关系不是立刻生效的，过多久也不好说，这就是个最新一致性的系统。</p>
<h3 id="Soft-state-软状态"><a href="#Soft-state-软状态" class="headerlink" title="Soft state(软状态)"></a>Soft state(软状态)</h3><p> 软状态故名思意就是可以变动的状态，强调的是数据状态处于一种临界状态。相对于软状态，就是硬状态，就是数据的状态是确定的。对于满足ACID的数据状态是硬状态。最终一致性的系统中，数据的读出来的不一定是最新的，我理解就是一种软状态即一种短暂的临时状态。</p>
<h2 id="如何保障基本可用"><a href="#如何保障基本可用" class="headerlink" title="如何保障基本可用"></a>如何保障基本可用</h2><p>一个正常的系统，不可用的情况，除了网络和硬件的原因外，多半是由于过载引起的。 过载的流量可能是短暂的，如果我们不加以控制，就可能会压垮系统，就要求我们要对流量进行控制来保障系统的可用性。</p>
<h3 id="削峰填谷"><a href="#削峰填谷" class="headerlink" title="削峰填谷"></a><strong>削峰填谷</strong></h3><p>如果流量的数据我们可以控制，比如我们在做个抢购，不同的商品我们可以错开抢购时间减少系统的压力；这样就避免了大量的流量突发到系统中，从而压垮系统；<br>如果我们无法控制流量，那我们可以将数据保存到队列中的方式。我们系统可以根据自己处理能力，来消费队列数据，从而达到削峰填谷的目的。</p>
<h3 id="延迟响应"><a href="#延迟响应" class="headerlink" title="延迟响应"></a><strong>延迟响应</strong></h3><p>刚才的削峰填谷利用到了队列，对用户的请求不直接处理，而是缓存起来，慢慢处理，处理完毕后再返回，这对用户来说响应被延迟了，但是系统却可以处理更多的用户请求，这也是保证系统基本可用的一种手段。</p>
<h3 id="服务降级"><a href="#服务降级" class="headerlink" title="服务降级"></a><strong>服务降级</strong></h3><p>服务降级体现了基本可用的基本所在，在超系统负载的大流量过来之后，我们牺牲系统非必要的功能，比如降低日志级别，比如显示分辨率更低的图片等手段，来降低系统的资源消耗，保证核心能力的正常运行，这也是保证系统基本可用手段。</p>
<h3 id="过载保护"><a href="#过载保护" class="headerlink" title="过载保护"></a><strong>过载保护</strong></h3><p>如果以上手段，还是无法应对现在的流量，只能进入过载保护截断了，系统根据自己的能力抛弃超时的请求，或者随机抛弃一些请求，直接返回错误。这是比较狠的，比较粗暴直接的手段来保证系统的可用。</p>
<h2 id="最终一致性"><a href="#最终一致性" class="headerlink" title="最终一致性"></a><strong>最终一致性</strong></h2><p>存在最终一致性的系统，显然是存在多个副本的，通过多个副本来保证系统的可用性。在网络中不同的节点存在同一个副本，那就会存在副本数据的不一致问题，因为网络复制必然会存在延迟，当然我们可以等所有的副本数据都同步完成后再进行返回给客户端，但是那样系统的性能必然比较低，而且一旦一个副本所在的节点断开了，系统就无法响应了，可用性都难以保证了。<br>所以在一致性要求不严格的情况下，我们多采用最终一致性，那最终又是通过上面手段来保证的那，是如果修复不同的副本数据那。</p>
<h3 id="写时修复"><a href="#写时修复" class="headerlink" title="写时修复"></a><strong>写时修复</strong></h3><p>其实这是能想到的最直接的方式，在多个副本写的时候，如果其中一个写失败了，就缓存起来，系统自动通过重试的手段进行修复。 在我看来，写时修复，更快达到最终一致性，因为修复动作离写操作最近。 而且写时修复不需要进行数据对比，所以性能最好。</p>
<h3 id="读时修复"><a href="#读时修复" class="headerlink" title="读时修复"></a><strong>读时修复</strong></h3><p>我们在写数据的时候不关心失败还是成功，只是在读数据的时候，我们可以同时读多个节点的同一份数据，然后根据一定的规则，比如以超过半数的数据值为准的办法，来决定返回的值，如果我们写的时候也按照一定规则的话（比如写要超过半数的节点），我们就可以任务这个数据值是正确的，以这个值为准修复刚才不是这个值的节点。 比如 Cassandra 的 Read Repair 模式下，读时候发现数据不一致的时候会自动修复。</p>
<h3 id="异步修复"><a href="#异步修复" class="headerlink" title="异步修复"></a><strong>异步修复</strong></h3><p>通过定时不同节点比对的方式，来对照数据是否需要修复，如果需要修复，则进行同步。 这种修复方式，由于涉及到数据的比对，所以性能不是很好。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a><strong>总结</strong></h2><p>BASE理论是ACID在复杂的互联网环节的一种妥协，通过弹性的基本可用来实现最终一致性。也是现在众多NoSQL系统的设计的理论基础。</p>
<h1 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h1><p>ACID是衡量事务的四个特性</p>
<ul>
<li>原子性（Atomicity）</li>
<li>一致性（Consistency）</li>
<li>隔离性（Isolation）</li>
<li>持久性（Durability）</li>
</ul>
<p>需要注意的是，在最开始的定义中，事务必须要满足这四个特性。<br>但在许多地方的实际应用中，这四个特性并没有被完全实现，比如MySQL、Redis的事务就不支持原子性，所以后来这四个特性渐渐地变成了衡量事务的标准而不是事务的必须条件</p>
<h3 id="原子性（Atomicity）"><a href="#原子性（Atomicity）" class="headerlink" title="原子性（Atomicity）"></a>原子性（Atomicity）</h3><p>原子性是指一个事务是一个不可分割的工作单位，其中的操作要么都做，要么都不做<br>数据库中：如果事务中一个sql语句执行失败，则已执行的语句也必须回滚，数据库退回到事务前的状态<br>（Ps：上面只是举个例子，要注意的是MySQL的事务并不支持原子性，在MySQL中，如果事务中的一条sql无法执行，它会将这一条sql报错，并继续执行接下来的sql，且已执行的sql也不回滚，除非我们主动使用逻辑判断要求报错时执行回滚，否则MySQL的事务本身是不会回滚的）</p>
<h3 id="持久性（Durability）"><a href="#持久性（Durability）" class="headerlink" title="持久性（Durability）"></a>持久性（Durability）</h3><p>持久性是指事务一旦提交，它对数据库的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。<br>简单理解：就是数据的持久化</p>
<h3 id="隔离性（Isolation）"><a href="#隔离性（Isolation）" class="headerlink" title="隔离性（Isolation）"></a>隔离性（Isolation）</h3><p>与原子性、持久性侧重于研究事务本身不同，隔离性研究的是不同事务之间的相互影响。<strong>隔离性是指，事务内部的操作与其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</strong><br>通常使用锁机制来保证事务的隔离性<br><strong>1：锁机制</strong><br>MySQL数据库中：MyIsam存储引擎只支持表锁，InnoDB存储引擎同时支持表锁和行锁，出于性能考虑，绝大多数情况下使用的都是行锁。<br><strong>2：脏读、不可重复读和幻读</strong><br>若不保证事务的隔离性，则有可能会出现数据的【脏读、不可重复读和幻读】<br>（1）脏读：当前事务(A)中可以读到其他事务(B)未提交的数据（脏数据），这种现象是脏读<br>举例如下（以账户余额表为例）：<br><img src="https://cdn.nlark.com/yuque/0/2023/webp/35579562/1685584110614-a12ce920-f780-4792-a053-40ee694627da.webp#averageHue=%23edeae4&clientId=u422b6b58-5b85-4&from=paste&id=ua37b8ef5&originHeight=392&originWidth=754&originalType=url&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&taskId=ud68512d8-ceb8-426a-9251-30761d6a2a9&title="><br>（2）不可重复读：在事务A中先后两次读取同一个数据，两次读取的结果不一样，这种现象称为不可重复读<br>脏读与不可重复读的区别在于：前者读到的是其他事务未提交的数据，后者读到的是其他事务已提交的数据。举例如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/webp/35579562/1685584110594-d8dd54f6-8097-446c-92ba-9ec1c20ea781.webp#averageHue=%23fafaf9&clientId=u422b6b58-5b85-4&from=paste&id=u37424c89&originHeight=455&originWidth=720&originalType=url&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&taskId=u80ecb5ee-ba26-476d-86d3-322f5971b1c&title="><br>（3）幻读：在事务A中按照某个条件先后两次查询数据库，两次查询结果的条数不同，这种现象称为幻读<br>不可重复读与幻读的区别可以通俗的理解为：前者是数据变了，后者是数据的行数变了。举例如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/webp/35579562/1685584110620-ef7fd809-68f0-48e0-8456-1e9ab9cfc0af.webp#averageHue=%23fbfafa&clientId=u422b6b58-5b85-4&from=paste&id=u0a2d52c6&originHeight=619&originWidth=720&originalType=url&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&taskId=u88caab6c-97b9-42e8-a330-014ef8c0952&title="><br><strong>2： 事务隔离级别</strong><br>SQL标准中定义了四种隔离级别，并规定了每种隔离级别下上述几个问题是否存在。一般来说，隔离级别越低，系统开销越低，可支持的并发越高，但隔离性也越差。隔离级别与读问题的关系如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/webp/35579562/1685584110621-28ab0c59-afd2-4960-993a-0f36f070ea6e.webp#averageHue=%23f7f7f6&clientId=u422b6b58-5b85-4&from=paste&id=u40401bdc&originHeight=465&originWidth=720&originalType=url&ratio=1.25&rotation=0&showTitle=false&status=done&style=none&taskId=uf3b8acf2-0f5c-483c-ab73-60759f2175f&title="><br>在实际应用中，<strong>读未提交</strong>在并发时会导致很多问题，而性能相对于其他隔离级别提高却很有限，因此使用较少。<strong>可串行化</strong>强制事务串行，并发效率很低，只有当对数据一致性要求极高且可以接受没有并发时使用，因此使用也较少。因此在大多数数据库系统中，默认的隔离级别是<strong>读已提交(如Oracle)<strong>或</strong>可重复读</strong><br>另外，InnoDB默认的隔离级别是【可重复读】，但是InnoDB通过MVCC（MVCC全称Multi-Version Concurrency Control，即多版本的并发控制协议）避免了幻读问题</p>
<h3 id="一致性（Consistency）"><a href="#一致性（Consistency）" class="headerlink" title="一致性（Consistency）"></a>一致性（Consistency）</h3><p>MySQL中：一致性是指事务执行结束后，<strong>数据库的完整性约束没有被破坏，事务执行的前后都是合法的数据状态。</strong><br>数据库的完整性约束包括但不限于：实体完整性（如行的主键存在且唯一）、列完整性（如字段的类型、大小、长度要符合要求）、外键约束、用户自定义完整性（如转账前后，两个账户余额的和应该不变）<br>简单理解：就是事务执行前后，数据的改变都是合法，且各方数据都是一致的<br>另外，我们应当理解到，事务的目的就是为了数据一致性<br><strong>如何实现事务的一致性：</strong><br>1：保证事务的原子性、持久性和隔离性<br>2：数据库本身提供保障，完善其完整性约束<br>3：应用层面进行保障，例如如果转账操作只扣除转账者的余额，而没有增加接收者的余额，无论数据库实现的多么完美，也无法保证状态的一致</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/15/Feign%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="河马">
      <meta itemprop="description" content="运气也是成功的一部分">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="河马窝苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/15/Feign%E8%BF%9C%E7%A8%8B%E8%B0%83%E7%94%A8/" class="post-title-link" itemprop="url">Feign远程调用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-15 19:20:16 / 修改时间：19:26:38" itemprop="dateCreated datePublished" datetime="2023-08-15T19:20:16+08:00">2023-08-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h1><h3 id="1）引入依赖"><a href="#1）引入依赖" class="headerlink" title="1）引入依赖"></a>1）引入依赖</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-openfeign&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="2）添加注解"><a href="#2）添加注解" class="headerlink" title="2）添加注解"></a>2）添加注解</h3><p>在启动类添加@EnableFeignClients注解</p>
<h3 id="3）编写Feign的客户端"><a href="#3）编写Feign的客户端" class="headerlink" title="3）编写Feign的客户端"></a>3）编写Feign的客户端</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个客户端主要是基于SpringMVC的注解来声明远程调用的信息，比如：</p>
<ul>
<li>服务名称：userservice</li>
<li>请求方式：GET</li>
<li>请求路径：&#x2F;user&#x2F;{id}</li>
<li>请求参数：Long id</li>
<li>返回值类型：User</li>
</ul>
<p>这样，Feign就可以帮助我们发送http请求，无需自己使用RestTemplate来发送了。</p>
<h3 id="4）测试"><a href="#4）测试" class="headerlink" title="4）测试"></a>4）测试</h3><p>修改order-service中的OrderService类中的queryOrderById方法，使用Feign客户端代替RestTemplate：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1685532176118-5a7429aa-8fca-4799-bfea-2501900b35d2.png#averageHue=%23eff7ea&clientId=u5ae376a6-e791-4&from=paste&height=338&id=u99e925a2&originHeight=423&originWidth=718&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=163754&status=done&style=none&taskId=u6d77954d-8065-4dc2-818b-04a3f9e10c0&title=&width=574.4" alt="image-20210714175415087.png"></p>
<h2 id="自定义配置"><a href="#自定义配置" class="headerlink" title="自定义配置"></a>自定义配置</h2><p>Feign可以支持很多的自定义配置，如下表所示：</p>
<table>
<thead>
<tr>
<th><strong>类型</strong></th>
<th><strong>作用</strong></th>
<th><strong>说明</strong></th>
</tr>
</thead>
<tbody><tr>
<td><strong>feign.Logger.Level</strong></td>
<td>修改日志级别</td>
<td>包含四种不同的级别：NONE、BASIC、HEADERS、FULL</td>
</tr>
<tr>
<td>feign.codec.Decoder</td>
<td>响应结果的解析器</td>
<td>http远程调用的结果做解析，例如解析json字符串为java对象</td>
</tr>
<tr>
<td>feign.codec.Encoder</td>
<td>请求参数编码</td>
<td>将请求参数编码，便于通过http请求发送</td>
</tr>
<tr>
<td>feign. Contract</td>
<td>支持的注解格式</td>
<td>默认是SpringMVC的注解</td>
</tr>
<tr>
<td>feign. Retryer</td>
<td>失败重试机制</td>
<td>请求失败的重试机制，默认是没有，不过会使用Ribbon的重试</td>
</tr>
</tbody></table>
<p>一般情况下，默认值就能满足我们使用，如果要自定义时，只需要创建自定义的@Bean覆盖默认Bean即可。</p>
<h3 id="Feign的日志配置"><a href="#Feign的日志配置" class="headerlink" title="Feign的日志配置"></a>Feign的日志配置</h3><h4 id="方式一是配置文件"><a href="#方式一是配置文件" class="headerlink" title="方式一是配置文件"></a>方式一是配置文件</h4><p>单个服务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">feign:  </span><br><span class="line">  client:</span><br><span class="line">    config: </span><br><span class="line">      userservice: # 针对某个微服务的配置</span><br><span class="line">        loggerLevel: FULL #  日志级别</span><br></pre></td></tr></table></figure>
<p>全局配置</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">feign:  </span><br><span class="line">  client:</span><br><span class="line">    config: </span><br><span class="line">      <span class="keyword">default</span>: # 这里用<span class="keyword">default</span>就是全局配置，如果是写服务名称，则是针对某个微服务的配置</span><br><span class="line">        loggerLevel: FULL #  日志级别</span><br></pre></td></tr></table></figure>
<h4 id="方式二是java代码配置"><a href="#方式二是java代码配置" class="headerlink" title="方式二是java代码配置"></a>方式二是java代码配置</h4><p>声明一个类，然后声明一个Logger.Level的对象</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DefaultFeignConfiguration</span>  &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Logger.Level <span class="title function_">feignLogLevel</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Logger.Level.BASIC; <span class="comment">// 日志级别为BASIC</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>全局生效-放启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(defaultConfiguration = DefaultFeignConfiguration .class)</span> </span><br></pre></td></tr></table></figure>
<p>局部生效-放到对应的@FeignClient这个注解中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(value = &quot;userservice&quot;, configuration = DefaultFeignConfiguration .class)</span> </span><br></pre></td></tr></table></figure>

<h3 id="Feign性能优化"><a href="#Feign性能优化" class="headerlink" title="Feign性能优化"></a>Feign性能优化</h3><ol>
<li>日志级别尽量用basic</li>
<li>使用HttpClient或OKHttp代替URLConnection<ol>
<li><p>引入feign-httpClient依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--httpClient的依赖 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.github.openfeign&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;feign-httpclient&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置文件开启httpClient功能，设置连接池参数</p>
</li>
</ol>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">feign:</span><br><span class="line">  client:</span><br><span class="line">    config:</span><br><span class="line">      <span class="keyword">default</span>: # <span class="keyword">default</span>全局的配置</span><br><span class="line">        loggerLevel: BASIC # 日志级别，BASIC就是基本的请求和响应信息</span><br><span class="line">  httpclient:</span><br><span class="line">    enabled: <span class="literal">true</span> # 开启feign对HttpClient的支持</span><br><span class="line">    max-connections: <span class="number">200</span> # 最大的连接数</span><br><span class="line">    max-connections-per-route: <span class="number">50</span> # 每个路径的最大连接数</span><br></pre></td></tr></table></figure>

<h3 id="不同包的FeignClient的导入有两种方式"><a href="#不同包的FeignClient的导入有两种方式" class="headerlink" title="不同包的FeignClient的导入有两种方式"></a>不同包的FeignClient的导入有两种方式</h3><p>方式一：<br>指定Feign应该扫描的包：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(basePackages = &quot;cn.itcast.feign.clients&quot;)</span></span><br></pre></td></tr></table></figure>
<p>方式二：<br>指定需要加载的Client接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableFeignClients(clients = &#123;UserClient.class&#125;)</span></span><br></pre></td></tr></table></figure>

<h3 id="配置超时时间"><a href="#配置超时时间" class="headerlink" title="配置超时时间"></a>配置超时时间</h3><h4 id="设置全局超时时间"><a href="#设置全局超时时间" class="headerlink" title="设置全局超时时间"></a>设置全局超时时间</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">## 方法一：设置在ribbon上</span><br><span class="line"><span class="attr">ribbon</span>:</span><br><span class="line">  <span class="title class_">OkToRetryOnAllOperations</span>: <span class="literal">false</span> #对所有操作请求都进行重试,默认<span class="literal">false</span></span><br><span class="line">  <span class="title class_">ReadTimeout</span>: <span class="number">5000</span>   #负载均衡超时时间，默认值<span class="number">5000</span></span><br><span class="line">  <span class="title class_">ConnectTimeout</span>: <span class="number">3000</span> #ribbon请求连接的超时时间，默认值<span class="number">2000</span></span><br><span class="line">  <span class="title class_">MaxAutoRetries</span>: <span class="number">0</span>     #对当前实例的重试次数，默认<span class="number">0</span></span><br><span class="line">  <span class="title class_">MaxAutoRetriesNextServer</span>: <span class="number">1</span> #对切换实例的重试次数，默认<span class="number">1</span></span><br><span class="line"></span><br><span class="line">## 方法二：设置在feign client上</span><br><span class="line"><span class="attr">feign</span>:</span><br><span class="line">  <span class="attr">client</span>:</span><br><span class="line">    <span class="attr">config</span>:</span><br><span class="line">      <span class="attr">default</span>:</span><br><span class="line">        <span class="attr">connectTimeout</span>: <span class="number">5000</span></span><br><span class="line">        <span class="attr">readTimeout</span>: <span class="number">3000</span></span><br></pre></td></tr></table></figure>
<h4 id="设置具体服务的超时时间"><a href="#设置具体服务的超时时间" class="headerlink" title="设置具体服务的超时时间"></a>设置具体服务的超时时间</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">feign</span>:</span><br><span class="line">  <span class="attr">client</span>:</span><br><span class="line">    <span class="attr">config</span>:</span><br><span class="line">      # 设置<span class="title class_">FooClient</span>的超时时间</span><br><span class="line">      <span class="title class_">FooClient</span>:</span><br><span class="line">        <span class="attr">connectTimeout</span>: <span class="number">5000</span></span><br><span class="line">        <span class="attr">readTimeout</span>: <span class="number">3000</span></span><br></pre></td></tr></table></figure>

<h3 id=""><a href="#" class="headerlink" title=""></a></h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/15/Nacos/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="河马">
      <meta itemprop="description" content="运气也是成功的一部分">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="河马窝苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/15/Nacos/" class="post-title-link" itemprop="url">Nacos</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-15 19:20:04 / 修改时间：19:27:53" itemprop="dateCreated datePublished" datetime="2023-08-15T19:20:04+08:00">2023-08-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.1k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>启动命令：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">startup.cmd -m standalone</span><br></pre></td></tr></table></figure>
<p>访问网址：<br><a target="_blank" rel="noopener" href="http://127.0.0.1:8848/nacos">http://127.0.0.1:8848/nacos</a></p>
<h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1685365298590-498ed782-a479-4683-9d22-4aa96c8fa891.png#averageHue=%23f9f7f5&clientId=ud8f04703-04b3-4&from=paste&height=557&id=u85d04349&originHeight=696&originWidth=1416&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=362928&status=done&style=none&taskId=ua19e2e1f-b693-486a-8691-578501dc0cf&title=&width=1132.8" alt="image.png"></h3><p><strong>流程</strong><br>:::info<br>首先启动nacos注册中心，所有的用户端端口全部注册到注册中心；订单模块访问用户模块时，会从注册中心拿到全部端口，从所有的端口中挑一个端口  通过restTemplate发起请求，相应的用户模块就会响应；然后订单模块如果再发起请求，则会选择其余剩下的端口发请求，因为@LoadBalanced的负载均衡。<br>:::</p>
<h1 id="服务注册到nacos"><a href="#服务注册到nacos" class="headerlink" title="服务注册到nacos"></a>服务注册到nacos</h1><h3 id="引入依赖"><a href="#引入依赖" class="headerlink" title="引入依赖"></a>引入依赖</h3><p>在cloud-demo父工程的pom文件中的<dependencyManagement>中引入SpringCloudAlibaba的依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2.6.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;type&gt;pom&lt;/type&gt;</span><br><span class="line">    &lt;scope&gt;import&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>然后在user-service和order-service中的pom文件中引入nacos-discovery依赖：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-discovery&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="配置nacos地址"><a href="#配置nacos地址" class="headerlink" title="配置nacos地址"></a>配置nacos地址</h3><p>在user-service和order-service的application.yml中添加nacos地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      server-addr: localhost:8848</span><br></pre></td></tr></table></figure>
<p>在user-service</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring</span><br><span class="line">  application:</span><br><span class="line">    name: user-server</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      #nacos服务器地址端口</span><br><span class="line">      server-addr: localhost:8848</span><br></pre></td></tr></table></figure>
<p>在order-service</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring</span><br><span class="line">	application:</span><br><span class="line">    name: order-server</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      #nacos服务器地址端口</span><br><span class="line">      server-addr: localhost:8848</span><br></pre></td></tr></table></figure>
<h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><p>重启微服务后，登录nacos管理页面，可以看到微服务信息</p>
<h1 id="服务分级存储模型"><a href="#服务分级存储模型" class="headerlink" title="服务分级存储模型"></a>服务分级存储模型</h1><p>假如user-service是服务，一个服务可以包含多个集群，如杭州、上海，每个集群下可以有多个实例，如8080，8081，形成分级模型<br><img src="https://cdn.nlark.com/yuque/0/2023/png/35579562/1685412001337-34eb575b-6fd9-4c9d-97e6-3309528d6b44.png#averageHue=%23faf9f6&clientId=u0d73bf19-012f-4&from=paste&height=616&id=u957a3087&originHeight=770&originWidth=1554&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=156527&status=done&style=none&taskId=ua605828e-3ab9-4817-8b66-79709b2e5ec&title=&width=1243.2" alt="image-20210713232522531.png"></p>
<ol>
<li>一级是服务，例如userservice</li>
<li>二级是集群，例如杭州或上海</li>
<li>三级是实例，例如杭州机房的某台部署了userservice的服务器</li>
</ol>
<h3 id="集群配置"><a href="#集群配置" class="headerlink" title="集群配置"></a>集群配置</h3><p>修改user-service的application.yml文件，添加集群配置：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      server-addr: localhost:8848</span><br><span class="line">      discovery:</span><br><span class="line">        cluster-name: HZ # 集群名称</span><br></pre></td></tr></table></figure>
<h3 id="NacosRule负载均衡策略"><a href="#NacosRule负载均衡策略" class="headerlink" title="NacosRule负载均衡策略"></a>NacosRule负载均衡策略</h3><ol>
<li>优先选择同集群服务实例列表</li>
<li>本地集群找不到提供者，才去其它集群寻找，并且会报警告</li>
<li>确定了可用实例列表后，再采用随机负载均衡挑选实例</li>
</ol>
<h3 id="实例的权重控制"><a href="#实例的权重控制" class="headerlink" title="实例的权重控制"></a>实例的权重控制</h3><ol>
<li>Nacos控制台可以设置实例的权重值，0~1之间</li>
<li>同集群内的多个实例，权重越高被访问的频率越高</li>
<li>权重设置为0则完全不会被访问</li>
</ol>
<h3 id="Nacos环境隔离"><a href="#Nacos环境隔离" class="headerlink" title="Nacos环境隔离"></a>Nacos环境隔离</h3><ol>
<li>namespace用来做环境隔离</li>
<li>每个namespace都有唯一id</li>
<li>不同namespace下的服务不可见</li>
</ol>
<h3 id="Nacos与eureka"><a href="#Nacos与eureka" class="headerlink" title="Nacos与eureka"></a>Nacos与eureka</h3><ul>
<li>Nacos与eureka的共同点<ul>
<li>都支持服务注册和服务拉取</li>
<li>都支持服务提供者心跳方式做健康检测</li>
</ul>
</li>
<li>Nacos与Eureka的区别<ul>
<li>Nacos支持服务端主动检测提供者状态：临时实例采用心跳模式，非临时实例采用主动检测模式</li>
<li>临时实例心跳不正常会被剔除，非临时实例则不会被剔除；eureka也有服务保护，不区分临时分临时，对所有的服务进行保护。</li>
<li>Nacos支持服务列表变更的消息推送模式，服务列表更新更及时。</li>
<li>Nacos集群默认采用AP方式，当集群中存在非临时实例时，采用CP模式；Eureka采用AP方式</li>
</ul>
</li>
</ul>
<h1 id="Nacos配置管理"><a href="#Nacos配置管理" class="headerlink" title="Nacos配置管理"></a>Nacos配置管理</h1><h2 id="统一配置管理"><a href="#统一配置管理" class="headerlink" title="统一配置管理"></a>统一配置管理</h2><h3 id="在nacos中添加配置文件"><a href="#在nacos中添加配置文件" class="headerlink" title="在nacos中添加配置文件"></a>在nacos中添加配置文件</h3><h3 id="在微服务中引入nacos和config依赖"><a href="#在微服务中引入nacos和config依赖" class="headerlink" title="在微服务中引入nacos和config依赖"></a>在微服务中引入nacos和config依赖</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--nacos配置管理依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-cloud-starter-alibaba-nacos-config&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="在微服务中添加bootstrap-yml，配置nacos地址、当前环境、服务名称、文件后缀名。这些决定了程序启动时去nacos读取哪个文件"><a href="#在微服务中添加bootstrap-yml，配置nacos地址、当前环境、服务名称、文件后缀名。这些决定了程序启动时去nacos读取哪个文件" class="headerlink" title="在微服务中添加bootstrap.yml，配置nacos地址、当前环境、服务名称、文件后缀名。这些决定了程序启动时去nacos读取哪个文件"></a>在微服务中添加bootstrap.yml，配置nacos地址、当前环境、服务名称、文件后缀名。这些决定了程序启动时去nacos读取哪个文件</h3><p>在user-service中添加一个bootstrap.yaml文件，内容如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: userservice # 服务名称</span><br><span class="line">  profiles:</span><br><span class="line">    active: dev #开发环境，这里是dev </span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      server-addr: localhost:8848 # Nacos地址</span><br><span class="line">      config:</span><br><span class="line">        file-extension: yaml # 文件后缀名</span><br></pre></td></tr></table></figure>
<p><strong>拓展</strong>：如何不用bootstrap.yml就可以读取nacos,注意要管理好依赖</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: userservice # 服务名称</span><br><span class="line">  cloud:</span><br><span class="line">    nacos:</span><br><span class="line">      server-addr: localhost:<span class="number">8848</span> # Nacos地址</span><br><span class="line">  config:</span><br><span class="line">    improt: </span><br><span class="line">	- optional: nacos: spring-config-<span class="keyword">import</span>-example.yaml</span><br></pre></td></tr></table></figure>
<h3 id="controller读取配置"><a href="#controller读取配置" class="headerlink" title="controller读取配置"></a>controller读取配置</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@Value(&quot;$&#123;pattern.dateformat&#125;&quot;)</span><br><span class="line">private String dateformat;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;now&quot;)</span><br><span class="line">public String now()&#123;</span><br><span class="line">    return LocalDateTime.now().format(DateTimeFormatter.ofPattern(dateformat));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="配置热更新"><a href="#配置热更新" class="headerlink" title="配置热更新"></a>配置热更新</h2><h3 id="方式一"><a href="#方式一" class="headerlink" title="方式一"></a>方式一</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在@Value注入的变量所在类上添加注解@RefreshScope</span><br></pre></td></tr></table></figure>
<h3 id="方式二"><a href="#方式二" class="headerlink" title="方式二"></a>方式二</h3><p>使用@ConfigurationProperties注解代替@Value注解。<br>在user-service服务中，添加一个类，读取patterrn.dateformat属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;pattern&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PatternProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String dateformat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/15/Redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="河马">
      <meta itemprop="description" content="运气也是成功的一部分">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="河马窝苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/15/Redis/" class="post-title-link" itemprop="url">Redis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-08-15 19:19:37 / 修改时间：19:32:13" itemprop="dateCreated datePublished" datetime="2023-08-15T19:19:37+08:00">2023-08-15</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>7.9k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>7 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Redis是一个基于<strong>内存</strong>的key-value结构数据库。Redis 是互联网技术领域使用最为广泛的<strong>存储中间件</strong><br><strong>主要特点：</strong></p>
<ul>
<li>基于内存存储，读写性能高</li>
<li>适合存储热点数据（热点商品、资讯、新闻）</li>
<li>企业应用广泛</li>
</ul>
<p><strong>关系型数据库(RDBMS)：</strong></p>
<ul>
<li>Mysql</li>
<li>Oracle</li>
<li>DB2</li>
<li>SQLServer</li>
</ul>
<p><strong>非关系型数据库(NoSql)：</strong></p>
<ul>
<li>Redis</li>
<li>Mongo db</li>
<li>MemCached</li>
</ul>
<h4 id="服务启动命令"><a href="#服务启动命令" class="headerlink" title="服务启动命令"></a>服务启动命令</h4><p>:::info<br><strong>redis-server.exe redis.windows.conf</strong><br>:::<br>Redis服务默认端口号为 <strong>6379</strong> ，通过快捷键<strong>Ctrl + C</strong> 即可停止Redis服务<br>当Redis服务启动成功后，可通过客户端进行连接。</p>
<h4 id="客户端连接命令"><a href="#客户端连接命令" class="headerlink" title="客户端连接命令"></a>客户端连接命令</h4><p>:::info<br><strong>redis-cli.exe</strong><br>:::<br>通过redis-cli.exe命令默认连接的是本地的redis服务，并且使用默认6379端口。也可以通过指定如下参数连接：</p>
<ul>
<li>-h ip地址</li>
<li>-p 端口号</li>
<li>-a 密码（如果需要）</li>
</ul>
<h4 id="修改Redis配置文件"><a href="#修改Redis配置文件" class="headerlink" title="修改Redis配置文件"></a>修改Redis配置文件</h4><p>设置Redis服务密码，修改redis.windows.conf</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">requirepass <span class="number">123456</span></span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<ul>
<li>修改密码后需要重启Redis服务才能生效</li>
<li>Redis配置文件中 # 表示注释</li>
</ul>
<p>重启Redis后，再次连接Redis时，需加上密码，否则连接失败。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli.exe -h localhost -p 6379 -a 123456</span><br></pre></td></tr></table></figure>
<p>此时，-h 和 -p 参数可省略不写。</p>
<h2 id="Redis数据类型"><a href="#Redis数据类型" class="headerlink" title="Redis数据类型"></a>Redis数据类型</h2><h3 id="五种常用数据类型介绍"><a href="#五种常用数据类型介绍" class="headerlink" title="五种常用数据类型介绍"></a>五种常用数据类型介绍</h3><p>Redis存储的是key-value结构的数据，其中key是字符串类型，value有5种常用的数据类型：</p>
<ul>
<li>字符串 string</li>
<li>哈希 hash</li>
<li>列表 list</li>
<li>集合 set</li>
<li>有序集合 sorted set &#x2F; zset</li>
</ul>
<h3 id="各种数据类型特点"><a href="#各种数据类型特点" class="headerlink" title="各种数据类型特点"></a>各种数据类型特点</h3><ul>
<li>字符串(string)：普通字符串，Redis中最简单的数据类型</li>
<li>哈希(hash)：也叫散列，类似于Java中的HashMap结构</li>
<li>列表(list)：按照插入顺序排序，可以有重复元素，类似于Java中的LinkedList</li>
<li>集合(set)：无序集合，没有重复元素，类似于Java中的HashSet</li>
<li>有序集合(sorted set&#x2F;zset)：集合中每个元素关联一个分数(score)，根据分数升序排序，没有重复元素</li>
</ul>
<h2 id="Redis常用命令"><a href="#Redis常用命令" class="headerlink" title="Redis常用命令"></a>Redis常用命令</h2><h3 id="字符串操作命令"><a href="#字符串操作命令" class="headerlink" title="字符串操作命令"></a>字符串操作命令</h3><p>Redis 中字符串类型常用命令：</p>
<ul>
<li><strong>SET</strong> key value 					 设置指定key的值</li>
<li><strong>GET</strong> key 获取指定key的值</li>
<li><strong>SETEX</strong> key seconds value 设置指定key的值，并将 key 的过期时间设为 seconds 秒</li>
<li><strong>SETNX</strong> key value 只有在 key 不存在时设置 key 的值</li>
</ul>
<p>更多命令可以参考Redis中文网：<a target="_blank" rel="noopener" href="https://www.redis.net.cn/">https://www.redis.net.cn</a></p>
<h3 id="哈希操作命令"><a href="#哈希操作命令" class="headerlink" title="哈希操作命令"></a>哈希操作命令</h3><p>Redis hash 是一个string类型的 field 和 value 的映射表，hash特别适合用于存储对象，常用命令：</p>
<ul>
<li><strong>HSET</strong> key field value 将哈希表 key 中的字段 field 的值设为 value</li>
<li><strong>HGET</strong> key field 获取存储在哈希表中指定字段的值</li>
<li><strong>HDEL</strong> key field 删除存储在哈希表中的指定字段</li>
<li><strong>HKEYS</strong> key 获取哈希表中所有字段</li>
<li><strong>HVALS</strong> key 获取哈希表中所有值</li>
</ul>
<h3 id="列表操作命令"><a href="#列表操作命令" class="headerlink" title="列表操作命令"></a>列表操作命令</h3><p>Redis 列表是简单的字符串列表，按照插入顺序排序，常用命令：</p>
<ul>
<li><strong>LPUSH</strong> key value1 [value2] 将一个或多个值插入到列表头部</li>
<li><strong>LRANGE</strong> key start stop 获取列表指定范围内的元素</li>
<li><strong>RPOP</strong> key 移除并获取列表最后一个元素</li>
<li><strong>LLEN</strong> key 获取列表长度</li>
<li><strong>BRPOP</strong> key1 [key2 ] timeout 移出并获取列表的最后一个元素， 如果列表没有元素会阻塞列表直到等待超 时或发现可弹出元素为止</li>
</ul>
<h3 id="集合操作命令"><a href="#集合操作命令" class="headerlink" title="集合操作命令"></a>集合操作命令</h3><p>Redis set 是string类型的无序集合。集合成员是唯一的，这就意味着集合中不能出现重复的数据，常用命令：</p>
<ul>
<li><strong>SADD</strong> key member1 [member2] 向集合添加一个或多个成员</li>
<li><strong>SMEMBERS</strong> key 返回集合中的所有成员</li>
<li><strong>SCARD</strong> key 获取集合的成员数</li>
<li><strong>SINTER</strong> key1 [key2] 返回给定所有集合的交集</li>
<li><strong>SUNION</strong> key1 [key2] 返回所有给定集合的并集</li>
<li><strong>SREM</strong> key member1 [member2] 移除集合中一个或多个成员</li>
</ul>
<h3 id="有序集合操作命令"><a href="#有序集合操作命令" class="headerlink" title="有序集合操作命令"></a>有序集合操作命令</h3><p>Redis有序集合是string类型元素的集合，且不允许有重复成员。每个元素都会关联一个double类型的分数。常用命令：<br>常用命令：</p>
<ul>
<li><strong>ZADD</strong> key score1 member1 [score2 member2] 向有序集合添加一个或多个成员</li>
<li><strong>ZRANGE</strong> key start stop [WITHSCORES] 通过索引区间返回有序集合中指定区间内的成员</li>
<li><strong>ZINCRBY</strong> key increment member 有序集合中对指定成员的分数加上增量 increment</li>
<li><strong>ZREM</strong> key member [member …] 移除有序集合中的一个或多个成员</li>
</ul>
<h3 id="通用命令"><a href="#通用命令" class="headerlink" title="通用命令"></a>通用命令</h3><p>Redis的通用命令是不分数据类型的，都可以使用的命令：</p>
<ul>
<li>KEYS pattern 		查找所有符合给定模式( pattern)的 key </li>
<li>EXISTS key 		检查给定 key 是否存在 </li>
<li>TYPE key 		返回 key 所储存的值的类型 </li>
<li>DEL key 		该命令用于在 key 存在是删除 key</li>
</ul>
<h2 id="在Java中操作Redis"><a href="#在Java中操作Redis" class="headerlink" title="在Java中操作Redis"></a>在Java中操作Redis</h2><h3 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h3><p><strong>1). 导入Spring Data Redis的maven坐标</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p><strong>2). 配置Redis数据源</strong><br>在application-dev.yml中添加</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sky:</span><br><span class="line">  redis:</span><br><span class="line">    host: localhost</span><br><span class="line">    port: 6379</span><br><span class="line">    password: 123456</span><br><span class="line">    database: 10</span><br></pre></td></tr></table></figure>
<p><strong>解释说明：</strong><br>database:指定使用Redis的哪个数据库，Redis服务启动后默认有16个数据库，编号分别是从0到15。<br>可以通过修改Redis配置文件来指定数据库的数量。<br>在application.yml中添加读取application-dev.yml中的相关Redis配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  profiles:</span><br><span class="line">    active: dev</span><br><span class="line">  redis:</span><br><span class="line">    host: $&#123;sky.redis.host&#125;</span><br><span class="line">    port: $&#123;sky.redis.port&#125;</span><br><span class="line">    password: $&#123;sky.redis.password&#125;</span><br><span class="line">    database: $&#123;sky.redis.database&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3). 编写配置类，创建RedisTemplate对象</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">package com.sky.config;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@Slf4j</span><br><span class="line">public class RedisConfiguration &#123;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public RedisTemplate redisTemplate(RedisConnectionFactory redisConnectionFactory)&#123;</span><br><span class="line">        log.info(&quot;开始创建redis模板对象...&quot;);</span><br><span class="line">        RedisTemplate redisTemplate = new RedisTemplate();</span><br><span class="line">        //设置redis的连接工厂对象</span><br><span class="line">        redisTemplate.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        //设置redis key的序列化器</span><br><span class="line">        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        return redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>解释说明：</strong><br>当前配置类不是必须的，因为 Spring Boot 框架会自动装配 RedisTemplate 对象，但是默认的key序列化器为<br>JdkSerializationRedisSerializer，导致我们存到Redis中后的数据和原始数据有差别，故设置为<br>StringRedisSerializer序列化器。<br><strong>4). 通过RedisTemplate对象操作Redis</strong><br>在test下新建测试类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">package com.sky.test;</span><br><span class="line"></span><br><span class="line">import org.junit.jupiter.api.Test;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line">import org.springframework.data.redis.core.*;</span><br><span class="line"></span><br><span class="line">@SpringBootTest</span><br><span class="line">public class SpringDataRedisTest &#123;</span><br><span class="line">    @Autowired</span><br><span class="line">    private RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void testRedisTemplate()&#123;</span><br><span class="line">        System.out.println(redisTemplate);</span><br><span class="line">        //string数据操作</span><br><span class="line">        ValueOperations valueOperations = redisTemplate.opsForValue();</span><br><span class="line">        //hash类型的数据操作</span><br><span class="line">        HashOperations hashOperations = redisTemplate.opsForHash();</span><br><span class="line">        //list类型的数据操作</span><br><span class="line">        ListOperations listOperations = redisTemplate.opsForList();</span><br><span class="line">        //set类型数据操作</span><br><span class="line">        SetOperations setOperations = redisTemplate.opsForSet();</span><br><span class="line">        //zset类型数据操作</span><br><span class="line">        ZSetOperations zSetOperations = redisTemplate.opsForZSet();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="操作常见类型数据"><a href="#操作常见类型数据" class="headerlink" title="操作常见类型数据"></a>操作常见类型数据</h3><p><strong>1). 操作字符串类型数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * 操作字符串类型的数据</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testString()&#123;</span><br><span class="line">        // set get setex setnx</span><br><span class="line">        redisTemplate.opsForValue().set(&quot;name&quot;,&quot;小明&quot;);</span><br><span class="line">        String city = (String) redisTemplate.opsForValue().get(&quot;name&quot;);</span><br><span class="line">        System.out.println(city);</span><br><span class="line">        redisTemplate.opsForValue().set(&quot;code&quot;,&quot;1234&quot;,3, TimeUnit.MINUTES);</span><br><span class="line">        redisTemplate.opsForValue().setIfAbsent(&quot;lock&quot;,&quot;1&quot;);</span><br><span class="line">        redisTemplate.opsForValue().setIfAbsent(&quot;lock&quot;,&quot;2&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>2). 操作哈希类型数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * 操作哈希类型的数据</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testHash()&#123;</span><br><span class="line">        //hset hget hdel hkeys hvals</span><br><span class="line">        HashOperations hashOperations = redisTemplate.opsForHash();</span><br><span class="line"></span><br><span class="line">        hashOperations.put(&quot;100&quot;,&quot;name&quot;,&quot;tom&quot;);</span><br><span class="line">        hashOperations.put(&quot;100&quot;,&quot;age&quot;,&quot;20&quot;);</span><br><span class="line"></span><br><span class="line">        String name = (String) hashOperations.get(&quot;100&quot;, &quot;name&quot;);</span><br><span class="line">        System.out.println(name);</span><br><span class="line"></span><br><span class="line">        Set keys = hashOperations.keys(&quot;100&quot;);</span><br><span class="line">        System.out.println(keys);</span><br><span class="line"></span><br><span class="line">        List values = hashOperations.values(&quot;100&quot;);</span><br><span class="line">        System.out.println(values);</span><br><span class="line"></span><br><span class="line">        hashOperations.delete(&quot;100&quot;,&quot;age&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>3). 操作列表类型数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * 操作列表类型的数据</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testList()&#123;</span><br><span class="line">        //lpush lrange rpop llen</span><br><span class="line">        ListOperations listOperations = redisTemplate.opsForList();</span><br><span class="line"></span><br><span class="line">        listOperations.leftPushAll(&quot;mylist&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;);</span><br><span class="line">        listOperations.leftPush(&quot;mylist&quot;,&quot;d&quot;);</span><br><span class="line"></span><br><span class="line">        List mylist = listOperations.range(&quot;mylist&quot;, 0, -1);</span><br><span class="line">        System.out.println(mylist);</span><br><span class="line"></span><br><span class="line">        listOperations.rightPop(&quot;mylist&quot;);</span><br><span class="line"></span><br><span class="line">        Long size = listOperations.size(&quot;mylist&quot;);</span><br><span class="line">        System.out.println(size);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>4). 操作集合类型数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * 操作集合类型的数据</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testSet()&#123;</span><br><span class="line">        //sadd smembers scard sinter sunion srem</span><br><span class="line">        SetOperations setOperations = redisTemplate.opsForSet();</span><br><span class="line"></span><br><span class="line">        setOperations.add(&quot;set1&quot;,&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;);</span><br><span class="line">        setOperations.add(&quot;set2&quot;,&quot;a&quot;,&quot;b&quot;,&quot;x&quot;,&quot;y&quot;);</span><br><span class="line"></span><br><span class="line">        Set members = setOperations.members(&quot;set1&quot;);</span><br><span class="line">        System.out.println(members);</span><br><span class="line"></span><br><span class="line">        Long size = setOperations.size(&quot;set1&quot;);</span><br><span class="line">        System.out.println(size);</span><br><span class="line"></span><br><span class="line">        Set intersect = setOperations.intersect(&quot;set1&quot;, &quot;set2&quot;);</span><br><span class="line">        System.out.println(intersect);</span><br><span class="line"></span><br><span class="line">        Set union = setOperations.union(&quot;set1&quot;, &quot;set2&quot;);</span><br><span class="line">        System.out.println(union);</span><br><span class="line"></span><br><span class="line">        setOperations.remove(&quot;set1&quot;,&quot;a&quot;,&quot;b&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>5). 操作有序集合类型数据</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * 操作有序集合类型的数据</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testZset()&#123;</span><br><span class="line">        //zadd zrange zincrby zrem</span><br><span class="line">        ZSetOperations zSetOperations = redisTemplate.opsForZSet();</span><br><span class="line"></span><br><span class="line">        zSetOperations.add(&quot;zset1&quot;,&quot;a&quot;,10);</span><br><span class="line">        zSetOperations.add(&quot;zset1&quot;,&quot;b&quot;,12);</span><br><span class="line">        zSetOperations.add(&quot;zset1&quot;,&quot;c&quot;,9);</span><br><span class="line"></span><br><span class="line">        Set zset1 = zSetOperations.range(&quot;zset1&quot;, 0, -1);</span><br><span class="line">        System.out.println(zset1);</span><br><span class="line"></span><br><span class="line">        zSetOperations.incrementScore(&quot;zset1&quot;,&quot;c&quot;,10);</span><br><span class="line"></span><br><span class="line">        zSetOperations.remove(&quot;zset1&quot;,&quot;a&quot;,&quot;b&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>6). 通用命令操作</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">     * 通用命令操作</span><br><span class="line">     */</span><br><span class="line">    @Test</span><br><span class="line">    public void testCommon()&#123;</span><br><span class="line">        //keys exists type del</span><br><span class="line">        Set keys = redisTemplate.keys(&quot;*&quot;);</span><br><span class="line">        System.out.println(keys);</span><br><span class="line"></span><br><span class="line">        Boolean name = redisTemplate.hasKey(&quot;name&quot;);</span><br><span class="line">        Boolean set1 = redisTemplate.hasKey(&quot;set1&quot;);</span><br><span class="line"></span><br><span class="line">        for (Object key : keys) &#123;</span><br><span class="line">            DataType type = redisTemplate.type(key);</span><br><span class="line">            System.out.println(type.name());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        redisTemplate.delete(&quot;mylist&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="河马"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">河马</p>
  <div class="site-description" itemprop="description">运气也是成功的一部分</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">20</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/hippoasleep" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;hippoasleep" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:JLhippo@163.com" title="E-Mail → mailto:JLhippo@163.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="link fa-fw"></i>
      链接网站
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://baidu.com/" title="https:&#x2F;&#x2F;baidu.com" rel="noopener" target="_blank">百度</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2023-08 – 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">河马</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">99k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:30</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>



    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 


        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
